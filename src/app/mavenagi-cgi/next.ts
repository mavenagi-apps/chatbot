// @ts-nocheck
var Kt=Object.create;var ge=Object.defineProperty;var Vt=Object.getOwnPropertyDescriptor;var Wt=Object.getOwnPropertyNames;var zt=Object.getPrototypeOf,Jt=Object.prototype.hasOwnProperty;var X=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Ht=(e,r)=>{for(var o in r)ge(e,o,{get:r[o],enumerable:!0})},Bt=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Wt(r))!Jt.call(e,n)&&n!==o&&ge(e,n,{get:()=>r[n],enumerable:!(t=Vt(r,n))||t.enumerable});return e};var Gt=(e,r,o)=>(o=e!=null?Kt(zt(e)):{},Bt(r||!e||!e.__esModule?ge(o,"default",{value:e,enumerable:!0}):o,e));var ar=X((bn,sr)=>{"use strict";var be=Object.defineProperty,Ft=Object.getOwnPropertyDescriptor,$t=Object.getOwnPropertyNames,qt=Object.prototype.hasOwnProperty,Yt=(e,r)=>{for(var o in r)be(e,o,{get:r[o],enumerable:!0})},Xt=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of $t(r))!qt.call(e,n)&&n!==o&&be(e,n,{get:()=>r[n],enumerable:!(t=Ft(r,n))||t.enumerable});return e},Qt=e=>Xt(be({},"__esModule",{value:!0}),e),Qe={};Yt(Qe,{CITY_HEADER_NAME:()=>Ze,COUNTRY_HEADER_NAME:()=>Ee,EMOJI_FLAG_UNICODE_STARTING_POSITION:()=>ir,IP_HEADER_NAME:()=>er,LATITUDE_HEADER_NAME:()=>rr,LONGITUDE_HEADER_NAME:()=>tr,REGION_HEADER_NAME:()=>or,REQUEST_ID_HEADER_NAME:()=>nr,geolocation:()=>to,ipAddress:()=>eo});sr.exports=Qt(Qe);var Ze="x-vercel-ip-city",Ee="x-vercel-ip-country",er="x-real-ip",rr="x-vercel-ip-latitude",tr="x-vercel-ip-longitude",or="x-vercel-ip-country-region",nr="x-vercel-id",ir=127397;function N(e,r){return e.headers.get(r)??void 0}function Zt(e){let r=new RegExp("^[A-Z]{2}$").test(e);if(!(!e||!r))return String.fromCodePoint(...e.split("").map(o=>ir+o.charCodeAt(0)))}function eo(e){return N(e,er)}function ro(e){return e?e.split(":")[0]:"dev1"}function to(e){return{city:N(e,Ze),country:N(e,Ee),flag:Zt(N(e,Ee)),countryRegion:N(e,or),region:ro(N(e,nr)),latitude:N(e,rr),longitude:N(e,tr)}}});var pr=X((xn,fr)=>{"use strict";var xe=Object.defineProperty,oo=Object.getOwnPropertyDescriptor,no=Object.getOwnPropertyNames,io=Object.prototype.hasOwnProperty,so=(e,r)=>{for(var o in r)xe(e,o,{get:r[o],enumerable:!0})},ao=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of no(r))!io.call(e,n)&&n!==o&&xe(e,n,{get:()=>r[n],enumerable:!(t=oo(r,n))||t.enumerable});return e},co=e=>ao(xe({},"__esModule",{value:!0}),e),cr={};so(cr,{getEnv:()=>fo});fr.exports=co(cr);var fo=(e=process.env)=>({VERCEL:g(e,"VERCEL"),CI:g(e,"CI"),VERCEL_ENV:g(e,"VERCEL_ENV"),VERCEL_URL:g(e,"VERCEL_URL"),VERCEL_BRANCH_URL:g(e,"VERCEL_BRANCH_URL"),VERCEL_PROJECT_PRODUCTION_URL:g(e,"VERCEL_PROJECT_PRODUCTION_URL"),VERCEL_REGION:g(e,"VERCEL_REGION"),VERCEL_DEPLOYMENT_ID:g(e,"VERCEL_DEPLOYMENT_ID"),VERCEL_SKEW_PROTECTION_ENABLED:g(e,"VERCEL_SKEW_PROTECTION_ENABLED"),VERCEL_AUTOMATION_BYPASS_SECRET:g(e,"VERCEL_AUTOMATION_BYPASS_SECRET"),VERCEL_GIT_PROVIDER:g(e,"VERCEL_GIT_PROVIDER"),VERCEL_GIT_REPO_SLUG:g(e,"VERCEL_GIT_REPO_SLUG"),VERCEL_GIT_REPO_OWNER:g(e,"VERCEL_GIT_REPO_OWNER"),VERCEL_GIT_REPO_ID:g(e,"VERCEL_GIT_REPO_ID"),VERCEL_GIT_COMMIT_REF:g(e,"VERCEL_GIT_COMMIT_REF"),VERCEL_GIT_COMMIT_SHA:g(e,"VERCEL_GIT_COMMIT_SHA"),VERCEL_GIT_COMMIT_MESSAGE:g(e,"VERCEL_GIT_COMMIT_MESSAGE"),VERCEL_GIT_COMMIT_AUTHOR_LOGIN:g(e,"VERCEL_GIT_COMMIT_AUTHOR_LOGIN"),VERCEL_GIT_COMMIT_AUTHOR_NAME:g(e,"VERCEL_GIT_COMMIT_AUTHOR_NAME"),VERCEL_GIT_PREVIOUS_SHA:g(e,"VERCEL_GIT_PREVIOUS_SHA"),VERCEL_GIT_PULL_REQUEST_ID:g(e,"VERCEL_GIT_PULL_REQUEST_ID")}),g=(e,r)=>{let o=e[r];return o===""?void 0:o}});var dr=X((_n,mr)=>{"use strict";var _e=Object.defineProperty,po=Object.getOwnPropertyDescriptor,uo=Object.getOwnPropertyNames,lo=Object.prototype.hasOwnProperty,mo=(e,r)=>{for(var o in r)_e(e,o,{get:r[o],enumerable:!0})},ho=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of uo(r))!lo.call(e,n)&&n!==o&&_e(e,n,{get:()=>r[n],enumerable:!(t=po(r,n))||t.enumerable});return e},yo=e=>ho(_e({},"__esModule",{value:!0}),e),ur={};mo(ur,{SYMBOL_FOR_REQ_CONTEXT:()=>lr,getContext:()=>go});mr.exports=yo(ur);var lr=Symbol.for("@vercel/request-context");function go(){return globalThis[lr]?.get?.()??{}}});var gr=X((Sn,yr)=>{"use strict";var Se=Object.defineProperty,Eo=Object.getOwnPropertyDescriptor,bo=Object.getOwnPropertyNames,xo=Object.prototype.hasOwnProperty,_o=(e,r)=>{for(var o in r)Se(e,o,{get:r[o],enumerable:!0})},So=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of bo(r))!xo.call(e,n)&&n!==o&&Se(e,n,{get:()=>r[n],enumerable:!(t=Eo(r,n))||t.enumerable});return e},wo=e=>So(Se({},"__esModule",{value:!0}),e),hr={};_o(hr,{waitUntil:()=>Ro});yr.exports=wo(hr);var Oo=dr(),Ro=e=>{if(e===null||typeof e!="object"||typeof e.then!="function")throw new TypeError(`waitUntil can only be called with a Promise, got ${typeof e}`);return(0,Oo.getContext)().waitUntil?.(e)}});var _r=X((wn,xr)=>{"use strict";var we=Object.defineProperty,vo=Object.getOwnPropertyDescriptor,Ao=Object.getOwnPropertyNames,To=Object.prototype.hasOwnProperty,Io=(e,r)=>{for(var o in r)we(e,o,{get:r[o],enumerable:!0})},Po=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Ao(r))!To.call(e,n)&&n!==o&&we(e,n,{get:()=>r[n],enumerable:!(t=vo(r,n))||t.enumerable});return e},Co=e=>Po(we({},"__esModule",{value:!0}),e),br={};Io(br,{geolocation:()=>Er.geolocation,getEnv:()=>No.getEnv,ipAddress:()=>Er.ipAddress,waitUntil:()=>jo.waitUntil});xr.exports=Co(br);var Er=ar(),No=pr(),jo=gr()});var $=Gt(_r());var M=crypto,oe=e=>e instanceof CryptoKey;var L=new TextEncoder,j=new TextDecoder,Rn=2**32;function Sr(...e){let r=e.reduce((n,{length:i})=>n+i,0),o=new Uint8Array(r),t=0;for(let n of e)o.set(n,t),t+=n.length;return o}var Uo=e=>{let r=atob(e),o=new Uint8Array(r.length);for(let t=0;t<r.length;t++)o[t]=r.charCodeAt(t);return o},U=e=>{let r=e;r instanceof Uint8Array&&(r=j.decode(r)),r=r.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Uo(r)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};var _=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(r){super(r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}},v=class extends _{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(r,o,t="unspecified",n="unspecified"){super(r),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=n,this.payload=o}},Q=class extends _{static get code(){return"ERR_JWT_EXPIRED"}constructor(r,o,t="unspecified",n="unspecified"){super(r),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=n,this.payload=o}},ne=class extends _{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},S=class extends _{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}};var E=class extends _{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},K=class extends _{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}};var Z=class extends _{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},V=class extends _{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},ie=class extends _{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},se=class extends _{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},ae=class extends _{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};function C(e,r="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${r} must be ${e}`)}function ce(e,r){return e.name===r}function Oe(e){return parseInt(e.name.slice(4),10)}function Do(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Mo(e,r){if(r.length&&!r.some(o=>e.usages.includes(o))){let o="CryptoKey does not support this operation, its usages must include ";if(r.length>2){let t=r.pop();o+=`one of ${r.join(", ")}, or ${t}.`}else r.length===2?o+=`one of ${r[0]} or ${r[1]}.`:o+=`${r[0]}.`;throw new TypeError(o)}}function wr(e,r,...o){switch(r){case"HS256":case"HS384":case"HS512":{if(!ce(e.algorithm,"HMAC"))throw C("HMAC");let t=parseInt(r.slice(2),10);if(Oe(e.algorithm.hash)!==t)throw C(`SHA-${t}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ce(e.algorithm,"RSASSA-PKCS1-v1_5"))throw C("RSASSA-PKCS1-v1_5");let t=parseInt(r.slice(2),10);if(Oe(e.algorithm.hash)!==t)throw C(`SHA-${t}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ce(e.algorithm,"RSA-PSS"))throw C("RSA-PSS");let t=parseInt(r.slice(2),10);if(Oe(e.algorithm.hash)!==t)throw C(`SHA-${t}`,"algorithm.hash");break}case"EdDSA":{if(e.algorithm.name!=="Ed25519"&&e.algorithm.name!=="Ed448")throw C("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!ce(e.algorithm,"ECDSA"))throw C("ECDSA");let t=Do(r);if(e.algorithm.namedCurve!==t)throw C(t,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Mo(e,o)}function Or(e,r,...o){if(o.length>2){let t=o.pop();e+=`one of type ${o.join(", ")}, or ${t}.`}else o.length===2?e+=`one of type ${o[0]} or ${o[1]}.`:e+=`of type ${o[0]}.`;return r==null?e+=` Received ${r}`:typeof r=="function"&&r.name?e+=` Received function ${r.name}`:typeof r=="object"&&r!=null&&r.constructor?.name&&(e+=` Received an instance of ${r.constructor.name}`),e}var Re=(e,...r)=>Or("Key must be ",e,...r);function ve(e,r,...o){return Or(`Key for the ${e} algorithm must be `,r,...o)}var Ae=e=>oe(e)?!0:e?.[Symbol.toStringTag]==="KeyObject",W=["CryptoKey"];var Lo=(...e)=>{let r=e.filter(Boolean);if(r.length===0||r.length===1)return!0;let o;for(let t of r){let n=Object.keys(t);if(!o||o.size===0){o=new Set(n);continue}for(let i of n){if(o.has(i))return!1;o.add(i)}}return!0},Rr=Lo;function Ko(e){return typeof e=="object"&&e!==null}function A(e){if(!Ko(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let r=e;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}var vr=(e,r)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:o}=r.algorithm;if(typeof o!="number"||o<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function Vo(e){let r,o;switch(e.kty){case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},o=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},o=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},o=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new S('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":r={name:"ECDSA",namedCurve:"P-256"},o=e.d?["sign"]:["verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},o=e.d?["sign"]:["verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},o=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:"ECDH",namedCurve:e.crv},o=e.d?["deriveBits"]:[];break;default:throw new S('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"EdDSA":r={name:e.crv},o=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:e.crv},o=e.d?["deriveBits"]:[];break;default:throw new S('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new S('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:r,keyUsages:o}}var Wo=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:r,keyUsages:o}=Vo(e),t=[r,e.ext??!1,e.key_ops??o],n={...e};return delete n.alg,delete n.use,M.subtle.importKey("jwk",n,...t)},fe=Wo;var Ar=e=>U(e),Te,Ie,Tr=e=>e?.[Symbol.toStringTag]==="KeyObject",Ir=async(e,r,o,t)=>{let n=e.get(r);if(n?.[t])return n[t];let i=await fe({...o,alg:t});return n?n[t]=i:e.set(r,{[t]:i}),i},zo=(e,r)=>{if(Tr(e)){let o=e.export({format:"jwk"});return delete o.d,delete o.dp,delete o.dq,delete o.p,delete o.q,delete o.qi,o.k?Ar(o.k):(Ie||(Ie=new WeakMap),Ir(Ie,e,o,r))}return e},Jo=(e,r)=>{if(Tr(e)){let o=e.export({format:"jwk"});return o.k?Ar(o.k):(Te||(Te=new WeakMap),Ir(Te,e,o,r))}return e},Pe={normalizePublicKey:zo,normalizePrivateKey:Jo};async function Pr(e,r){if(!A(e))throw new TypeError("JWK must be an object");switch(r||(r=e.alg),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return U(e.k);case"RSA":if(e.oth!==void 0)throw new S('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return fe({...e,alg:r});default:throw new S('Unsupported "kty" (Key Type) Parameter value')}}var z=e=>e?.[Symbol.toStringTag],Ho=(e,r)=>{if(!(r instanceof Uint8Array)){if(!Ae(r))throw new TypeError(ve(e,r,...W,"Uint8Array"));if(r.type!=="secret")throw new TypeError(`${z(r)} instances for symmetric algorithms must be of type "secret"`)}},Bo=(e,r,o)=>{if(!Ae(r))throw new TypeError(ve(e,r,...W));if(r.type==="secret")throw new TypeError(`${z(r)} instances for asymmetric algorithms must not be of type "secret"`);if(o==="sign"&&r.type==="public")throw new TypeError(`${z(r)} instances for asymmetric algorithm signing must be of type "private"`);if(o==="decrypt"&&r.type==="public")throw new TypeError(`${z(r)} instances for asymmetric algorithm decryption must be of type "private"`);if(r.algorithm&&o==="verify"&&r.type==="private")throw new TypeError(`${z(r)} instances for asymmetric algorithm verifying must be of type "public"`);if(r.algorithm&&o==="encrypt"&&r.type==="private")throw new TypeError(`${z(r)} instances for asymmetric algorithm encryption must be of type "public"`)},Go=(e,r,o)=>{e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?Ho(e,r):Bo(e,r,o)},Cr=Go;function Fo(e,r,o,t,n){if(n.crit!==void 0&&t?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!t||t.crit===void 0)return new Set;if(!Array.isArray(t.crit)||t.crit.length===0||t.crit.some(c=>typeof c!="string"||c.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;o!==void 0?i=new Map([...Object.entries(o),...r.entries()]):i=r;for(let c of t.crit){if(!i.has(c))throw new S(`Extension Header Parameter "${c}" is not recognized`);if(n[c]===void 0)throw new e(`Extension Header Parameter "${c}" is missing`);if(i.get(c)&&t[c]===void 0)throw new e(`Extension Header Parameter "${c}" MUST be integrity protected`)}return new Set(t.crit)}var Nr=Fo;var $o=(e,r)=>{if(r!==void 0&&(!Array.isArray(r)||r.some(o=>typeof o!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(r)return new Set(r)},jr=$o;function Ce(e,r){let o=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:o,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:o,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:o,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:o,name:"ECDSA",namedCurve:r.namedCurve};case"EdDSA":return{name:r.name};default:throw new S(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function Ne(e,r,o){if(o==="sign"&&(r=await Pe.normalizePrivateKey(r,e)),o==="verify"&&(r=await Pe.normalizePublicKey(r,e)),oe(r))return wr(r,e,o),r;if(r instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(Re(r,...W));return M.subtle.importKey("raw",r,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[o])}throw new TypeError(Re(r,...W,"Uint8Array"))}var qo=async(e,r,o,t)=>{let n=await Ne(e,r,"verify");vr(e,n);let i=Ce(e,n.algorithm);try{return await M.subtle.verify(i,n,o,t)}catch{return!1}},Ur=qo;async function kr(e,r,o){if(!A(e))throw new E("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new E('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new E("JWS Protected Header incorrect type");if(e.payload===void 0)throw new E("JWS Payload missing");if(typeof e.signature!="string")throw new E("JWS Signature missing or incorrect type");if(e.header!==void 0&&!A(e.header))throw new E("JWS Unprotected Header incorrect type");let t={};if(e.protected)try{let ye=U(e.protected);t=JSON.parse(j.decode(ye))}catch{throw new E("JWS Protected Header is invalid")}if(!Rr(t,e.header))throw new E("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...t,...e.header},i=Nr(E,new Map([["b64",!0]]),o?.crit,t,n),c=!0;if(i.has("b64")&&(c=t.b64,typeof c!="boolean"))throw new E('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if(typeof a!="string"||!a)throw new E('JWS "alg" (Algorithm) Header Parameter missing or invalid');let p=o&&jr("algorithms",o.algorithms);if(p&&!p.has(a))throw new ne('"alg" (Algorithm) Header Parameter value not allowed');if(c){if(typeof e.payload!="string")throw new E("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new E("JWS Payload must be a string or an Uint8Array instance");let f=!1;typeof r=="function"&&(r=await r(t,e),f=!0),Cr(a,r,"verify");let u=Sr(L.encode(e.protected??""),L.encode("."),typeof e.payload=="string"?L.encode(e.payload):e.payload),y;try{y=U(e.signature)}catch{throw new E("Failed to base64url decode the signature")}if(!await Ur(a,r,y,u))throw new ae;let R;if(c)try{R=U(e.payload)}catch{throw new E("Failed to base64url decode the payload")}else typeof e.payload=="string"?R=L.encode(e.payload):R=e.payload;let O={payload:R};return e.protected!==void 0&&(O.protectedHeader=t),e.header!==void 0&&(O.unprotectedHeader=e.header),f?{...O,key:r}:O}async function Dr(e,r,o){if(e instanceof Uint8Array&&(e=j.decode(e)),typeof e!="string")throw new E("Compact JWS must be a string or Uint8Array");let{0:t,1:n,2:i,length:c}=e.split(".");if(c!==3)throw new E("Invalid Compact JWS");let a=await kr({payload:n,protected:t,signature:i},r,o),p={payload:a.payload,protectedHeader:a.protectedHeader};return typeof r=="function"?{...p,key:a.key}:p}var Mr=e=>Math.floor(e.getTime()/1e3);var Yo=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,je=e=>{let r=Yo.exec(e);if(!r||r[4]&&r[1])throw new TypeError("Invalid time period format");let o=parseFloat(r[2]),t=r[3].toLowerCase(),n;switch(t){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(o);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(o*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(o*3600);break;case"day":case"days":case"d":n=Math.round(o*86400);break;case"week":case"weeks":case"w":n=Math.round(o*604800);break;default:n=Math.round(o*31557600);break}return r[1]==="-"||r[4]==="ago"?-n:n};var Lr=e=>e.toLowerCase().replace(/^application\//,""),Xo=(e,r)=>typeof e=="string"?r.includes(e):Array.isArray(e)?r.some(Set.prototype.has.bind(new Set(e))):!1,Kr=(e,r,o={})=>{let t;try{t=JSON.parse(j.decode(r))}catch{}if(!A(t))throw new K("JWT Claims Set must be a top-level JSON object");let{typ:n}=o;if(n&&(typeof e.typ!="string"||Lr(e.typ)!==Lr(n)))throw new v('unexpected "typ" JWT header value',t,"typ","check_failed");let{requiredClaims:i=[],issuer:c,subject:a,audience:p,maxTokenAge:f}=o,u=[...i];f!==void 0&&u.push("iat"),p!==void 0&&u.push("aud"),a!==void 0&&u.push("sub"),c!==void 0&&u.push("iss");for(let O of new Set(u.reverse()))if(!(O in t))throw new v(`missing required "${O}" claim`,t,O,"missing");if(c&&!(Array.isArray(c)?c:[c]).includes(t.iss))throw new v('unexpected "iss" claim value',t,"iss","check_failed");if(a&&t.sub!==a)throw new v('unexpected "sub" claim value',t,"sub","check_failed");if(p&&!Xo(t.aud,typeof p=="string"?[p]:p))throw new v('unexpected "aud" claim value',t,"aud","check_failed");let y;switch(typeof o.clockTolerance){case"string":y=je(o.clockTolerance);break;case"number":y=o.clockTolerance;break;case"undefined":y=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:x}=o,R=Mr(x||new Date);if((t.iat!==void 0||f)&&typeof t.iat!="number")throw new v('"iat" claim must be a number',t,"iat","invalid");if(t.nbf!==void 0){if(typeof t.nbf!="number")throw new v('"nbf" claim must be a number',t,"nbf","invalid");if(t.nbf>R+y)throw new v('"nbf" claim timestamp check failed',t,"nbf","check_failed")}if(t.exp!==void 0){if(typeof t.exp!="number")throw new v('"exp" claim must be a number',t,"exp","invalid");if(t.exp<=R-y)throw new Q('"exp" claim timestamp check failed',t,"exp","check_failed")}if(f){let O=R-t.iat,ye=typeof f=="number"?f:je(f);if(O-y>ye)throw new Q('"iat" claim timestamp check failed (too far in the past)',t,"iat","check_failed");if(O<0-y)throw new v('"iat" claim timestamp check failed (it should be in the past)',t,"iat","check_failed")}return t};async function Ue(e,r,o){let t=await Dr(e,r,o);if(t.protectedHeader.crit?.includes("b64")&&t.protectedHeader.b64===!1)throw new K("JWTs MUST NOT use unencoded payload");let i={payload:Kr(t.protectedHeader,t.payload,o),protectedHeader:t.protectedHeader};return typeof r=="function"?{...i,key:t.key}:i}function Qo(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new S('Unsupported "alg" value for a JSON Web Key Set')}}function Zo(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(en)}function en(e){return A(e)}function Wr(e){return typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}var ke=class{constructor(r){if(this._cached=new WeakMap,!Zo(r))throw new Z("JSON Web Key Set malformed");this._jwks=Wr(r)}async getKey(r,o){let{alg:t,kid:n}={...r,...o?.header},i=Qo(t),c=this._jwks.keys.filter(f=>{let u=i===f.kty;if(u&&typeof n=="string"&&(u=n===f.kid),u&&typeof f.alg=="string"&&(u=t===f.alg),u&&typeof f.use=="string"&&(u=f.use==="sig"),u&&Array.isArray(f.key_ops)&&(u=f.key_ops.includes("verify")),u&&t==="EdDSA"&&(u=f.crv==="Ed25519"||f.crv==="Ed448"),u)switch(t){case"ES256":u=f.crv==="P-256";break;case"ES256K":u=f.crv==="secp256k1";break;case"ES384":u=f.crv==="P-384";break;case"ES512":u=f.crv==="P-521";break}return u}),{0:a,length:p}=c;if(p===0)throw new V;if(p!==1){let f=new ie,{_cached:u}=this;throw f[Symbol.asyncIterator]=async function*(){for(let y of c)try{yield await Vr(u,y,t)}catch{}},f}return Vr(this._cached,a,t)}};async function Vr(e,r,o){let t=e.get(r)||e.set(r,{}).get(r);if(t[o]===void 0){let n=await Pr({...r,ext:!0},o);if(n instanceof Uint8Array||n.type!=="public")throw new Z("JSON Web Key Set members must be public keys");t[o]=n}return t[o]}function De(e){let r=new ke(e),o=async(t,n)=>r.getKey(t,n);return Object.defineProperties(o,{jwks:{value:()=>Wr(r._jwks),enumerable:!0,configurable:!1,writable:!1}}),o}var rn=async(e,r,o)=>{let t,n,i=!1;typeof AbortController=="function"&&(t=new AbortController,n=setTimeout(()=>{i=!0,t.abort()},r));let c=await fetch(e.href,{signal:t?t.signal:void 0,redirect:"manual",headers:o.headers}).catch(a=>{throw i?new se:a});if(n!==void 0&&clearTimeout(n),c.status!==200)throw new _("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await c.json()}catch{throw new _("Failed to parse the JSON Web Key Set HTTP response as JSON")}},zr=rn;function tn(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}var Me;(typeof navigator>"u"||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(Me="jose/v5.8.0");var pe=Symbol();function on(e,r){return!(typeof e!="object"||e===null||!("uat"in e)||typeof e.uat!="number"||Date.now()-e.uat>=r||!("jwks"in e)||!A(e.jwks)||!Array.isArray(e.jwks.keys)||!Array.prototype.every.call(e.jwks.keys,A))}var Le=class{constructor(r,o){if(!(r instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(r.href),this._options={agent:o?.agent,headers:o?.headers},this._timeoutDuration=typeof o?.timeoutDuration=="number"?o?.timeoutDuration:5e3,this._cooldownDuration=typeof o?.cooldownDuration=="number"?o?.cooldownDuration:3e4,this._cacheMaxAge=typeof o?.cacheMaxAge=="number"?o?.cacheMaxAge:6e5,o?.[pe]!==void 0&&(this._cache=o?.[pe],on(o?.[pe],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=De(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(r,o){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(r,o)}catch(t){if(t instanceof V&&this.coolingDown()===!1)return await this.reload(),this._local(r,o);throw t}}async reload(){this._pendingFetch&&tn()&&(this._pendingFetch=void 0);let r=new Headers(this._options.headers);Me&&!r.has("User-Agent")&&(r.set("User-Agent",Me),this._options.headers=Object.fromEntries(r.entries())),this._pendingFetch||(this._pendingFetch=zr(this._url,this._timeoutDuration,this._options).then(o=>{this._local=De(o),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=o),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(o=>{throw this._pendingFetch=void 0,o})),await this._pendingFetch}};function Ke(e,r){let o=new Le(e,r),t=async(n,i)=>o.getKey(n,i);return Object.defineProperties(t,{coolingDown:{get:()=>o.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>o.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>o.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!o._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>o._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),t}var Ve,We,ze,Je,He,nn=typeof window<"u"&&typeof window.document<"u",sn=typeof self=="object"&&typeof self?.importScripts=="function"&&(((Ve=self.constructor)===null||Ve===void 0?void 0:Ve.name)==="DedicatedWorkerGlobalScope"||((We=self.constructor)===null||We===void 0?void 0:We.name)==="ServiceWorkerGlobalScope"||((ze=self.constructor)===null||ze===void 0?void 0:ze.name)==="SharedWorkerGlobalScope"),Jr=typeof Deno<"u"&&typeof Deno.version<"u"&&typeof Deno.version.deno<"u",Hr=typeof Bun<"u"&&typeof Bun.version<"u",an=typeof process<"u"&&!!process.version&&!!(!((Je=process.versions)===null||Je===void 0)&&Je.node)&&!Jr&&!Hr,cn=typeof navigator<"u"&&navigator?.product==="ReactNative",fn=typeof globalThis<"u"&&((He=globalThis?.navigator)===null||He===void 0?void 0:He.userAgent)==="Cloudflare-Workers",Be=pn();function pn(){return nn?{type:"browser",version:window.navigator.userAgent}:fn?{type:"workerd"}:sn?{type:"web-worker"}:Jr?{type:"deno",version:Deno.version.deno}:Hr?{type:"bun",version:Bun.version}:an?{type:"node",version:process.versions.node,parsedVersion:Number(process.versions.node.split(".")[0])}:cn?{type:"react-native"}:{type:"unknown"}}var s={};Ht(s,{JsonError:()=>J,ParseError:()=>H,any:()=>it,bigint:()=>Gr,boolean:()=>st,booleanLiteral:()=>nt,date:()=>Fr,discriminant:()=>ht,enum_:()=>le,getObjectLikeUtils:()=>I,getObjectUtils:()=>G,getSchemaUtils:()=>h,isProperty:()=>D,lazy:()=>$r,lazyObject:()=>rt,list:()=>de,number:()=>at,object:()=>me,objectWithoutOptionalProperties:()=>et,optional:()=>Ge,property:()=>Yr,record:()=>ut,set:()=>lt,string:()=>ct,stringLiteral:()=>ot,transform:()=>Fe,undiscriminatedUnion:()=>dt,union:()=>gt,unknown:()=>ft,withParsedProperties:()=>qe});var l={BIGINT:"bigint",DATE:"date",ENUM:"enum",LIST:"list",STRING_LITERAL:"stringLiteral",BOOLEAN_LITERAL:"booleanLiteral",OBJECT:"object",ANY:"any",BOOLEAN:"boolean",NUMBER:"number",STRING:"string",UNKNOWN:"unknown",RECORD:"record",SET:"set",UNION:"union",UNDISCRIMINATED_UNION:"undiscriminatedUnion",OPTIONAL:"optional"};function m(e,r){return`Expected ${r}. Received ${un(e)}.`}function un(e){if(Array.isArray(e))return"list";if(e===null)return"null";if(e instanceof BigInt)return"BigInt";switch(typeof e){case"string":return`"${e}"`;case"bigint":case"number":case"boolean":case"undefined":return`${e}`}return typeof e}function b(e){return Object.assign(Object.assign({},e),{json:Br(e.json),parse:Br(e.parse)})}function Br(e){return(r,o)=>{let t=e(r,o),{skipValidation:n=!1}=o??{};return!t.ok&&n?(console.warn(["Failed to validate.",...t.errors.map(i=>"  - "+(i.path.length>0?`${i.path.join(".")}: ${i.message}`:i.message))].join(`
`)),{ok:!0,value:r}):t}}function ue(e){return e.path.length===0?e.message:`${e.path.join(" -> ")}: ${e.message}`}var J=class e extends Error{constructor(r){super(r.map(ue).join("; ")),this.errors=r,Object.setPrototypeOf(this,e.prototype)}};var H=class e extends Error{constructor(r){super(r.map(ue).join("; ")),this.errors=r,Object.setPrototypeOf(this,e.prototype)}};function h(e){return{optional:()=>Ge(e),transform:r=>Fe(e,r),parseOrThrow:(r,o)=>{let t=e.parse(r,o);if(t.ok)return t.value;throw new H(t.errors)},jsonOrThrow:(r,o)=>{let t=e.json(r,o);if(t.ok)return t.value;throw new J(t.errors)}}}function Ge(e){let r={parse:(o,t)=>o==null?{ok:!0,value:void 0}:e.parse(o,t),json:(o,t)=>t?.omitUndefined&&o===void 0?{ok:!0,value:void 0}:o==null?{ok:!0,value:null}:e.json(o,t),getType:()=>l.OPTIONAL};return Object.assign(Object.assign({},r),h(r))}function Fe(e,r){let o={parse:(t,n)=>{let i=e.parse(t,n);return i.ok?{ok:!0,value:r.transform(i.value)}:i},json:(t,n)=>{let i=r.untransform(t);return e.json(i,n)},getType:()=>e.getType()};return Object.assign(Object.assign({},o),h(o))}function Gr(){let e={parse:(r,{breadcrumbsPrefix:o=[]}={})=>typeof r!="string"?{ok:!1,errors:[{path:o,message:m(r,"string")}]}:{ok:!0,value:BigInt(r)},json:(r,{breadcrumbsPrefix:o=[]}={})=>typeof r=="bigint"?{ok:!0,value:r.toString()}:{ok:!1,errors:[{path:o,message:m(r,"bigint")}]},getType:()=>l.BIGINT};return Object.assign(Object.assign({},b(e)),h(e))}var ln=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Fr(){let e={parse:(r,{breadcrumbsPrefix:o=[]}={})=>typeof r!="string"?{ok:!1,errors:[{path:o,message:m(r,"string")}]}:ln.test(r)?{ok:!0,value:new Date(r)}:{ok:!1,errors:[{path:o,message:m(r,"ISO 8601 date string")}]},json:(r,{breadcrumbsPrefix:o=[]}={})=>r instanceof Date?{ok:!0,value:r.toISOString()}:{ok:!1,errors:[{path:o,message:m(r,"Date object")}]},getType:()=>l.DATE};return Object.assign(Object.assign({},b(e)),h(e))}function w(e,r){return()=>{let o={parse:r,json:r,getType:()=>e};return Object.assign(Object.assign({},b(o)),h(o))}}function le(e){let r=new Set(e);return w(l.ENUM,(t,{allowUnrecognizedEnumValues:n,breadcrumbsPrefix:i=[]}={})=>typeof t!="string"?{ok:!1,errors:[{path:i,message:m(t,"string")}]}:!r.has(t)&&!n?{ok:!1,errors:[{path:i,message:m(t,"enum")}]}:{ok:!0,value:t})()}function $r(e){let r=$e(e);return Object.assign(Object.assign({},r),h(r))}function $e(e){return{parse:(r,o)=>B(e).parse(r,o),json:(r,o)=>B(e).json(r,o),getType:()=>B(e).getType()}}function B(e){let r=e;return r.__zurg_memoized==null&&(r.__zurg_memoized=e()),r.__zurg_memoized}function ee(e){return Object.entries(e)}function re(e,r){let o=new Set(r);return Object.entries(e).reduce((t,[n,i])=>(o.has(n)&&(t[n]=i),t),{})}function k(e){if(typeof e!="object"||e===null)return!1;if(Object.getPrototypeOf(e)===null)return!0;let r=e;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}function te(e){return Object.keys(e)}function qr(e,r){let o=[],t=[];for(let n of e)r(n)?o.push(n):t.push(n);return[o,t]}function I(e){return{withParsedProperties:r=>qe(e,r)}}function qe(e,r){let o={parse:(t,n)=>{let i=e.parse(t,n);if(!i.ok)return i;let c=Object.entries(r).reduce((a,[p,f])=>Object.assign(Object.assign({},a),{[p]:typeof f=="function"?f(i.value):f}),{});return{ok:!0,value:Object.assign(Object.assign({},i.value),c)}},json:(t,n)=>{var i;if(!k(t))return{ok:!1,errors:[{path:(i=n?.breadcrumbsPrefix)!==null&&i!==void 0?i:[],message:m(t,"object")}]};let c=new Set(Object.keys(r)),a=re(t,Object.keys(t).filter(p=>!c.has(p)));return e.json(a,n)},getType:()=>e.getType()};return Object.assign(Object.assign(Object.assign({},o),h(o)),I(o))}function Yr(e,r){return{rawKey:e,valueSchema:r,isProperty:!0}}function D(e){return e.isProperty}function me(e){let r={_getRawProperties:()=>Object.entries(e).map(([o,t])=>D(t)?t.rawKey:o),_getParsedProperties:()=>te(e),parse:(o,t)=>{let n={},i=[];for(let[c,a]of ee(e)){let p=D(a)?a.rawKey:c,f=D(a)?a.valueSchema:a,u={rawKey:p,parsedKey:c,valueSchema:f};n[p]=u,Zr(f)&&i.push(p)}return Xr({value:o,requiredKeys:i,getProperty:c=>{let a=n[c];if(a!=null)return{transformedKey:a.parsedKey,transform:p=>{var f;return a.valueSchema.parse(p,Object.assign(Object.assign({},t),{breadcrumbsPrefix:[...(f=t?.breadcrumbsPrefix)!==null&&f!==void 0?f:[],c]}))}}},unrecognizedObjectKeys:t?.unrecognizedObjectKeys,skipValidation:t?.skipValidation,breadcrumbsPrefix:t?.breadcrumbsPrefix,omitUndefined:t?.omitUndefined})},json:(o,t)=>{let n=[];for(let[i,c]of ee(e)){let a=D(c)?c.valueSchema:c;Zr(a)&&n.push(i)}return Xr({value:o,requiredKeys:n,getProperty:i=>{let c=e[i];if(c!=null)return D(c)?{transformedKey:c.rawKey,transform:a=>{var p;return c.valueSchema.json(a,Object.assign(Object.assign({},t),{breadcrumbsPrefix:[...(p=t?.breadcrumbsPrefix)!==null&&p!==void 0?p:[],i]}))}}:{transformedKey:i,transform:a=>{var p;return c.json(a,Object.assign(Object.assign({},t),{breadcrumbsPrefix:[...(p=t?.breadcrumbsPrefix)!==null&&p!==void 0?p:[],i]}))}}},unrecognizedObjectKeys:t?.unrecognizedObjectKeys,skipValidation:t?.skipValidation,breadcrumbsPrefix:t?.breadcrumbsPrefix,omitUndefined:t?.omitUndefined})},getType:()=>l.OBJECT};return Object.assign(Object.assign(Object.assign(Object.assign({},b(r)),h(r)),I(r)),G(r))}function Xr({value:e,requiredKeys:r,getProperty:o,unrecognizedObjectKeys:t="fail",skipValidation:n=!1,breadcrumbsPrefix:i=[]}){if(!k(e))return{ok:!1,errors:[{path:i,message:m(e,"object")}]};let c=new Set(r),a=[],p={};for(let[f,u]of Object.entries(e)){let y=o(f);if(y!=null){c.delete(f);let x=y.transform(u);x.ok?p[y.transformedKey]=x.value:(p[f]=u,a.push(...x.errors))}else switch(t){case"fail":a.push({path:[...i,f],message:`Unexpected key "${f}"`});break;case"strip":break;case"passthrough":p[f]=u;break}}return a.push(...r.filter(f=>c.has(f)).map(f=>({path:i,message:`Missing required key "${f}"`}))),a.length===0||n?{ok:!0,value:p}:{ok:!1,errors:a}}function G(e){return{extend:r=>{let o={_getParsedProperties:()=>[...e._getParsedProperties(),...r._getParsedProperties()],_getRawProperties:()=>[...e._getRawProperties(),...r._getRawProperties()],parse:(t,n)=>Qr({extensionKeys:r._getRawProperties(),value:t,transformBase:i=>e.parse(i,n),transformExtension:i=>r.parse(i,n)}),json:(t,n)=>Qr({extensionKeys:r._getParsedProperties(),value:t,transformBase:i=>e.json(i,n),transformExtension:i=>r.json(i,n)}),getType:()=>l.OBJECT};return Object.assign(Object.assign(Object.assign(Object.assign({},o),h(o)),I(o)),G(o))}}}function Qr({extensionKeys:e,value:r,transformBase:o,transformExtension:t}){let n=new Set(e),[i,c]=qr(te(r),f=>n.has(f)),a=o(re(r,c)),p=t(re(r,i));return a.ok&&p.ok?{ok:!0,value:Object.assign(Object.assign({},a.value),p.value)}:{ok:!1,errors:[...a.ok?[]:a.errors,...p.ok?[]:p.errors]}}function Zr(e){return!mn(e)}function mn(e){switch(e.getType()){case l.ANY:case l.UNKNOWN:case l.OPTIONAL:return!0;default:return!1}}function et(e){return me(e)}function rt(e){let r=Object.assign(Object.assign({},$e(e)),{_getRawProperties:()=>B(e)._getRawProperties(),_getParsedProperties:()=>B(e)._getParsedProperties()});return Object.assign(Object.assign(Object.assign(Object.assign({},r),h(r)),I(r)),G(r))}function de(e){let r={parse:(o,t)=>tt(o,(n,i)=>{var c;return e.parse(n,Object.assign(Object.assign({},t),{breadcrumbsPrefix:[...(c=t?.breadcrumbsPrefix)!==null&&c!==void 0?c:[],`[${i}]`]}))}),json:(o,t)=>tt(o,(n,i)=>{var c;return e.json(n,Object.assign(Object.assign({},t),{breadcrumbsPrefix:[...(c=t?.breadcrumbsPrefix)!==null&&c!==void 0?c:[],`[${i}]`]}))}),getType:()=>l.LIST};return Object.assign(Object.assign({},b(r)),h(r))}function tt(e,r){return Array.isArray(e)?e.map((t,n)=>r(t,n)).reduce((t,n)=>{if(t.ok&&n.ok)return{ok:!0,value:[...t.value,n.value]};let i=[];return t.ok||i.push(...t.errors),n.ok||i.push(...n.errors),{ok:!1,errors:i}},{ok:!0,value:[]}):{ok:!1,errors:[{message:m(e,"list"),path:[]}]}}function ot(e){return w(l.STRING_LITERAL,(o,{breadcrumbsPrefix:t=[]}={})=>o===e?{ok:!0,value:e}:{ok:!1,errors:[{path:t,message:m(o,`"${e}"`)}]})()}function nt(e){return w(l.BOOLEAN_LITERAL,(o,{breadcrumbsPrefix:t=[]}={})=>o===e?{ok:!0,value:e}:{ok:!1,errors:[{path:t,message:m(o,`${e.toString()}`)}]})()}var it=w(l.ANY,e=>({ok:!0,value:e}));var st=w(l.BOOLEAN,(e,{breadcrumbsPrefix:r=[]}={})=>typeof e=="boolean"?{ok:!0,value:e}:{ok:!1,errors:[{path:r,message:m(e,"boolean")}]});var at=w(l.NUMBER,(e,{breadcrumbsPrefix:r=[]}={})=>typeof e=="number"?{ok:!0,value:e}:{ok:!1,errors:[{path:r,message:m(e,"number")}]});var ct=w(l.STRING,(e,{breadcrumbsPrefix:r=[]}={})=>typeof e=="string"?{ok:!0,value:e}:{ok:!1,errors:[{path:r,message:m(e,"string")}]});var ft=w(l.UNKNOWN,e=>({ok:!0,value:e}));function ut(e,r){let o={parse:(t,n)=>pt({value:t,isKeyNumeric:e.getType()===l.NUMBER,transformKey:i=>{var c;return e.parse(i,Object.assign(Object.assign({},n),{breadcrumbsPrefix:[...(c=n?.breadcrumbsPrefix)!==null&&c!==void 0?c:[],`${i} (key)`]}))},transformValue:(i,c)=>{var a;return r.parse(i,Object.assign(Object.assign({},n),{breadcrumbsPrefix:[...(a=n?.breadcrumbsPrefix)!==null&&a!==void 0?a:[],`${c}`]}))},breadcrumbsPrefix:n?.breadcrumbsPrefix}),json:(t,n)=>pt({value:t,isKeyNumeric:e.getType()===l.NUMBER,transformKey:i=>{var c;return e.json(i,Object.assign(Object.assign({},n),{breadcrumbsPrefix:[...(c=n?.breadcrumbsPrefix)!==null&&c!==void 0?c:[],`${i} (key)`]}))},transformValue:(i,c)=>{var a;return r.json(i,Object.assign(Object.assign({},n),{breadcrumbsPrefix:[...(a=n?.breadcrumbsPrefix)!==null&&a!==void 0?a:[],`${c}`]}))},breadcrumbsPrefix:n?.breadcrumbsPrefix}),getType:()=>l.RECORD};return Object.assign(Object.assign({},b(o)),h(o))}function pt({value:e,isKeyNumeric:r,transformKey:o,transformValue:t,breadcrumbsPrefix:n=[]}){return k(e)?ee(e).reduce((i,[c,a])=>{if(a==null)return i;let p=i,f=c;if(r){let R=c.length>0?Number(c):NaN;isNaN(R)||(f=R)}let u=o(f),y=t(a,f);if(p.ok&&u.ok&&y.ok)return{ok:!0,value:Object.assign(Object.assign({},p.value),{[u.value]:y.value})};let x=[];return p.ok||x.push(...p.errors),u.ok||x.push(...u.errors),y.ok||x.push(...y.errors),{ok:!1,errors:x}},{ok:!0,value:{}}):{ok:!1,errors:[{path:n,message:m(e,"object")}]}}function lt(e){let r=de(e),o={parse:(t,n)=>{let i=r.parse(t,n);return i.ok?{ok:!0,value:new Set(i.value)}:i},json:(t,n)=>{var i;return t instanceof Set?r.json([...t],n):{ok:!1,errors:[{path:(i=n?.breadcrumbsPrefix)!==null&&i!==void 0?i:[],message:m(t,"Set")}]}},getType:()=>l.SET};return Object.assign(Object.assign({},b(o)),h(o))}function dt(e){let r={parse:(o,t)=>mt((n,i)=>n.parse(o,i),e,t),json:(o,t)=>mt((n,i)=>n.json(o,i),e,t),getType:()=>l.UNDISCRIMINATED_UNION};return Object.assign(Object.assign({},b(r)),h(r))}function mt(e,r,o){let t=[];for(let[n,i]of r.entries()){let c=e(i,Object.assign(Object.assign({},o),{skipValidation:!1}));if(c.ok)return c;for(let a of c.errors)t.push({path:a.path,message:`[Variant ${n}] ${a.message}`})}return{ok:!1,errors:t}}function ht(e,r){return{parsedDiscriminant:e,rawDiscriminant:r}}var dn=function(e,r){var o={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(e);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(e,t[n])&&(o[t[n]]=e[t[n]]);return o};function gt(e,r){let o=typeof e=="string"?e:e.rawDiscriminant,t=typeof e=="string"?e:e.parsedDiscriminant,n=le(te(r)),i={parse:(c,a)=>yt({value:c,discriminant:o,transformedDiscriminant:t,transformDiscriminantValue:p=>{var f;return n.parse(p,{allowUnrecognizedEnumValues:a?.allowUnrecognizedUnionMembers,breadcrumbsPrefix:[...(f=a?.breadcrumbsPrefix)!==null&&f!==void 0?f:[],o]})},getAdditionalPropertiesSchema:p=>r[p],allowUnrecognizedUnionMembers:a?.allowUnrecognizedUnionMembers,transformAdditionalProperties:(p,f)=>f.parse(p,a),breadcrumbsPrefix:a?.breadcrumbsPrefix}),json:(c,a)=>yt({value:c,discriminant:t,transformedDiscriminant:o,transformDiscriminantValue:p=>{var f;return n.json(p,{allowUnrecognizedEnumValues:a?.allowUnrecognizedUnionMembers,breadcrumbsPrefix:[...(f=a?.breadcrumbsPrefix)!==null&&f!==void 0?f:[],t]})},getAdditionalPropertiesSchema:p=>r[p],allowUnrecognizedUnionMembers:a?.allowUnrecognizedUnionMembers,transformAdditionalProperties:(p,f)=>f.json(p,a),breadcrumbsPrefix:a?.breadcrumbsPrefix}),getType:()=>l.UNION};return Object.assign(Object.assign(Object.assign({},b(i)),h(i)),I(i))}function yt({value:e,discriminant:r,transformedDiscriminant:o,transformDiscriminantValue:t,getAdditionalPropertiesSchema:n,allowUnrecognizedUnionMembers:i=!1,transformAdditionalProperties:c,breadcrumbsPrefix:a=[]}){if(!k(e))return{ok:!1,errors:[{path:a,message:m(e,"object")}]};let p=e,f=r,u=p[f],y=dn(p,[typeof f=="symbol"?f:f+""]);if(u==null)return{ok:!1,errors:[{path:a,message:`Missing discriminant ("${r}")`}]};let x=t(u);if(!x.ok)return{ok:!1,errors:x.errors};let R=n(x.value);if(R==null)return i?{ok:!0,value:Object.assign({[o]:x.value},y)}:{ok:!1,errors:[{path:[...a,r],message:"Unexpected discriminant value"}]};let O=c(y,R);return O.ok?{ok:!0,value:Object.assign({[o]:u},O.value)}:O}var T=s.object({organizationId:s.string(),agentId:s.string(),settings:s.record(s.string(),s.unknown())});var Et=s.object({}).extend(T);var bt=s.object({}).extend(T);var xt=s.enum_(["CONVERSATION","CONVERSATION_MESSAGE","KNOWLEDGE_BASE","KNOWLEDGE_DOCUMENT","ACTION","USER","USER_EVENT","EVENT_TRIGGER","USER_PROFILE","FEEDBACK"]);var F=s.object({referenceId:s.string()});var P=s.object({type:xt,appId:s.string(),organizationId:s.string(),agentId:s.string()}).extend(F);var _t=s.enum_(["THUMBS_UP","THUMBS_DOWN","INSERT","HANDOFF"]);var St=s.object({type:_t,text:s.string().optional()});var wt=s.object({feedbackId:P,conversationId:P,conversationMessageId:P}).extend(St);var Ot=s.object({feedbacks:s.list(wt)}).extend(T);var Rt=s.object({conversations:s.list(P)}).extend(T);var vt=s.object({allUserData:s.record(s.string(),s.record(s.string(),s.string())),defaultUserData:s.record(s.string(),s.string())});var At=s.object({actionId:s.string(),conversationMetadata:s.record(s.string(),s.string()),parameters:s.record(s.string(),s.unknown()),user:vt}).extend(T);var Ap=s.object({response:s.string()});var Tt=s.object({knowledgeBaseId:F}).extend(T);var Wp=s.object({message:s.string().optional()});function It(e){return e}var Pt=s.string().transform({transform:It,untransform:e=>e});var Ct=s.enum_(["text","array","color"]);var Nt=s.object({displayName:s.string(),description:s.string().optional(),type:Ct});var Zu=s.record(Pt,Nt);var jt=s.enum_(["EMAIL","PHONE_NUMBER"]);var Ut=s.object({value:s.string(),type:jt});var kt=s.enum_(["VISIBLE","PARTIALLY_VISIBLE","HIDDEN"]);var Dt=s.object({value:s.string(),visibility:kt});var he=s.object({identifiers:s.list(Ut),data:s.record(s.string(),Dt)});var ll=s.object({userId:F}).extend(he);var yl=s.object({userId:P,allUserData:s.record(s.string(),s.record(s.string(),s.string())),defaultUserData:s.record(s.string(),s.string())}).extend(he);var Mt=s.enum_(["CONVERSATION_CREATED","FEEDBACK_CREATED"]);var Lt=s.object({description:s.string(),type:Mt});var wl=s.object({triggerId:P}).extend(Lt);var Rl=s.object({number:s.number(),size:s.number(),totalElements:s.number(),totalPages:s.number()});import q from"../..";async function Y(e){let o=`https://developers${process.env.ENVIRONMENT===void 0?"":`.${process.env.ENVIRONMENT==="sandbox"?`${process.env.SANDBOX_USER}.sb`:process.env.ENVIRONMENT}`}.mavenagi-apis.com/.well-known/jwks`,t=Ke(new URL(o)),n=e.headers.get("authorization").replace("Bearer ","");await Ue(n,t,{issuer:"https://developers.mavenagi.com",audience:process.env.MAVENAGI_APP_ID})}async function sm(e){await Y(e);let{organizationId:r,agentId:o,settings:t,actionId:n,conversationMetadata:i,parameters:c,user:a}=At.parseOrThrow(await e.json());try{let p=await q.executeAction?.({organizationId:r,agentId:o,settings:t,actionId:n,conversationMetadata:i,parameters:c,user:a});return new Response(JSON.stringify({response:p}),{status:200,headers:{"Content-Type":"application/json"}})}catch(p){return console.error(p),p instanceof Error?new Response(p.message,{status:500}):new Response("No result returned",{status:204})}}async function am(e){await Y(e);let{organizationId:r,agentId:o,settings:t,feedbacks:n}=Ot.parseOrThrow(await e.json());try{return await q.feedbackCreatedOrUpdated?.({organizationId:r,agentId:o,settings:t,feedbacks:n,ctx:{waitUntil:$.waitUntil}}),new Response(null)}catch(i){return console.error(i),i instanceof Error?new Response(i.message,{status:500}):new Response("Unknown error",{status:500})}}async function cm(e){await Y(e);let{organizationId:r,agentId:o,settings:t,conversations:n}=Rt.parseOrThrow(await e.json());try{return await q.conversationCreatedOrUpdated?.({organizationId:r,agentId:o,settings:t,conversations:n,ctx:{waitUntil:$.waitUntil}}),new Response(null)}catch(i){return console.error(i),i instanceof Error?new Response(i.message,{status:500}):new Response("Unknown error",{status:500})}}async function fm(e){await Y(e);let{organizationId:r,agentId:o,settings:t,knowledgeBaseId:n}=Tt.parseOrThrow(await e.json());try{return await q.knowledgeBaseRefreshed?.({organizationId:r,agentId:o,knowledgeBaseId:n,settings:t,ctx:{waitUntil:$.waitUntil}}),new Response(null)}catch(i){return console.error(i),i instanceof Error?new Response(i.message,{status:500}):new Response("Unknown error",{status:500})}}async function pm(e){await Y(e);let{organizationId:r,agentId:o,settings:t}=bt.parseOrThrow(await e.json());try{return await q.postInstall?.({organizationId:r,agentId:o,settings:t,ctx:{waitUntil:$.waitUntil}}),new Response(null)}catch(n){return console.error(n),n instanceof Error?new Response(n.message,{status:400}):new Response("Unknown error",{status:500})}}async function um(e){await Y(e);let{organizationId:r,agentId:o,settings:t}=Et.parseOrThrow(await e.json(),{unrecognizedObjectKeys:"strip",allowUnrecognizedEnumValues:!0,allowUnrecognizedUnionMembers:!0});try{return await q.preInstall?.({organizationId:r,agentId:o,settings:t,ctx:{waitUntil:$.waitUntil}}),new Response(null)}catch(n){return console.error(n),n instanceof Error?new Response(n.message,{status:400}):new Response("Unknown error",{status:500})}}export{cm as conversationCreatedOrUpdated,sm as executeAction,am as feedbackCreatedOrUpdated,fm as knowledgeBaseRefreshed,pm as postInstall,um as preInstall};

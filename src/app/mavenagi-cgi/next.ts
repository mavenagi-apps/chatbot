// @ts-nocheck
var $t=Object.create;var Se=Object.defineProperty;var qt=Object.getOwnPropertyDescriptor;var Yt=Object.getOwnPropertyNames;var Xt=Object.getPrototypeOf,Qt=Object.prototype.hasOwnProperty;var te=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Zt=(e,r)=>{for(var t in r)Se(e,t,{get:r[t],enumerable:!0})},eo=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Yt(r))!Qt.call(e,n)&&n!==t&&Se(e,n,{get:()=>r[n],enumerable:!(o=qt(r,n))||o.enumerable});return e};var ro=(e,r,t)=>(t=e!=null?$t(Xt(e)):{},eo(r||!e||!e.__esModule?Se(t,"default",{value:e,enumerable:!0}):t,e));var hr=te((In,dr)=>{"use strict";var Oe=Object.defineProperty,to=Object.getOwnPropertyDescriptor,oo=Object.getOwnPropertyNames,no=Object.prototype.hasOwnProperty,io=(e,r)=>{for(var t in r)Oe(e,t,{get:r[t],enumerable:!0})},so=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of oo(r))!no.call(e,n)&&n!==t&&Oe(e,n,{get:()=>r[n],enumerable:!(o=to(r,n))||o.enumerable});return e},ao=e=>so(Oe({},"__esModule",{value:!0}),e),sr={};io(sr,{CITY_HEADER_NAME:()=>ar,COUNTRY_HEADER_NAME:()=>we,EMOJI_FLAG_UNICODE_STARTING_POSITION:()=>mr,IP_HEADER_NAME:()=>cr,LATITUDE_HEADER_NAME:()=>fr,LONGITUDE_HEADER_NAME:()=>pr,REGION_HEADER_NAME:()=>ur,REQUEST_ID_HEADER_NAME:()=>lr,geolocation:()=>lo,ipAddress:()=>po});dr.exports=ao(sr);var ar="x-vercel-ip-city",we="x-vercel-ip-country",cr="x-real-ip",fr="x-vercel-ip-latitude",pr="x-vercel-ip-longitude",ur="x-vercel-ip-country-region",lr="x-vercel-id",mr=127397;function U(e,r){return e.get(r)??void 0}function co(e,r){let t=U(e.headers,r);return t?decodeURIComponent(t):void 0}function fo(e){let r=new RegExp("^[A-Z]{2}$").test(e);if(!(!e||!r))return String.fromCodePoint(...e.split("").map(t=>mr+t.charCodeAt(0)))}function po(e){let r="headers"in e?e.headers:e;return U(r,cr)}function uo(e){return e?e.split(":")[0]:"dev1"}function lo(e){return{city:co(e,ar),country:U(e.headers,we),flag:fo(U(e.headers,we)),countryRegion:U(e.headers,ur),region:uo(U(e.headers,lr)),latitude:U(e.headers,fr),longitude:U(e.headers,pr)}}});var br=te((Pn,gr)=>{"use strict";var ve=Object.defineProperty,mo=Object.getOwnPropertyDescriptor,ho=Object.getOwnPropertyNames,yo=Object.prototype.hasOwnProperty,go=(e,r)=>{for(var t in r)ve(e,t,{get:r[t],enumerable:!0})},bo=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of ho(r))!yo.call(e,n)&&n!==t&&ve(e,n,{get:()=>r[n],enumerable:!(o=mo(r,n))||o.enumerable});return e},Eo=e=>bo(ve({},"__esModule",{value:!0}),e),yr={};go(yr,{getEnv:()=>xo});gr.exports=Eo(yr);var xo=(e=process.env)=>({VERCEL:b(e,"VERCEL"),CI:b(e,"CI"),VERCEL_ENV:b(e,"VERCEL_ENV"),VERCEL_URL:b(e,"VERCEL_URL"),VERCEL_BRANCH_URL:b(e,"VERCEL_BRANCH_URL"),VERCEL_PROJECT_PRODUCTION_URL:b(e,"VERCEL_PROJECT_PRODUCTION_URL"),VERCEL_REGION:b(e,"VERCEL_REGION"),VERCEL_DEPLOYMENT_ID:b(e,"VERCEL_DEPLOYMENT_ID"),VERCEL_SKEW_PROTECTION_ENABLED:b(e,"VERCEL_SKEW_PROTECTION_ENABLED"),VERCEL_AUTOMATION_BYPASS_SECRET:b(e,"VERCEL_AUTOMATION_BYPASS_SECRET"),VERCEL_GIT_PROVIDER:b(e,"VERCEL_GIT_PROVIDER"),VERCEL_GIT_REPO_SLUG:b(e,"VERCEL_GIT_REPO_SLUG"),VERCEL_GIT_REPO_OWNER:b(e,"VERCEL_GIT_REPO_OWNER"),VERCEL_GIT_REPO_ID:b(e,"VERCEL_GIT_REPO_ID"),VERCEL_GIT_COMMIT_REF:b(e,"VERCEL_GIT_COMMIT_REF"),VERCEL_GIT_COMMIT_SHA:b(e,"VERCEL_GIT_COMMIT_SHA"),VERCEL_GIT_COMMIT_MESSAGE:b(e,"VERCEL_GIT_COMMIT_MESSAGE"),VERCEL_GIT_COMMIT_AUTHOR_LOGIN:b(e,"VERCEL_GIT_COMMIT_AUTHOR_LOGIN"),VERCEL_GIT_COMMIT_AUTHOR_NAME:b(e,"VERCEL_GIT_COMMIT_AUTHOR_NAME"),VERCEL_GIT_PREVIOUS_SHA:b(e,"VERCEL_GIT_PREVIOUS_SHA"),VERCEL_GIT_PULL_REQUEST_ID:b(e,"VERCEL_GIT_PULL_REQUEST_ID")}),b=(e,r)=>{let t=e[r];return t===""?void 0:t}});var Sr=te((Nn,_r)=>{"use strict";var Re=Object.defineProperty,_o=Object.getOwnPropertyDescriptor,So=Object.getOwnPropertyNames,wo=Object.prototype.hasOwnProperty,Oo=(e,r)=>{for(var t in r)Re(e,t,{get:r[t],enumerable:!0})},vo=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of So(r))!wo.call(e,n)&&n!==t&&Re(e,n,{get:()=>r[n],enumerable:!(o=_o(r,n))||o.enumerable});return e},Ro=e=>vo(Re({},"__esModule",{value:!0}),e),Er={};Oo(Er,{SYMBOL_FOR_REQ_CONTEXT:()=>xr,getContext:()=>To});_r.exports=Ro(Er);var xr=Symbol.for("@vercel/request-context");function To(){return globalThis[xr]?.get?.()??{}}});var vr=te((Cn,Or)=>{"use strict";var Te=Object.defineProperty,Ao=Object.getOwnPropertyDescriptor,Io=Object.getOwnPropertyNames,Po=Object.prototype.hasOwnProperty,No=(e,r)=>{for(var t in r)Te(e,t,{get:r[t],enumerable:!0})},Co=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Io(r))!Po.call(e,n)&&n!==t&&Te(e,n,{get:()=>r[n],enumerable:!(o=Ao(r,n))||o.enumerable});return e},jo=e=>Co(Te({},"__esModule",{value:!0}),e),wr={};No(wr,{waitUntil:()=>Ko});Or.exports=jo(wr);var Uo=Sr(),Ko=e=>{if(e===null||typeof e!="object"||typeof e.then!="function")throw new TypeError(`waitUntil can only be called with a Promise, got ${typeof e}`);return(0,Uo.getContext)().waitUntil?.(e)}});var Ir=te((jn,Ar)=>{"use strict";var Ae=Object.defineProperty,ko=Object.getOwnPropertyDescriptor,Do=Object.getOwnPropertyNames,Mo=Object.prototype.hasOwnProperty,Lo=(e,r)=>{for(var t in r)Ae(e,t,{get:r[t],enumerable:!0})},Wo=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Do(r))!Mo.call(e,n)&&n!==t&&Ae(e,n,{get:()=>r[n],enumerable:!(o=ko(r,n))||o.enumerable});return e},Vo=e=>Wo(Ae({},"__esModule",{value:!0}),e),Tr={};Lo(Tr,{geolocation:()=>Rr.geolocation,getEnv:()=>zo.getEnv,ipAddress:()=>Rr.ipAddress,waitUntil:()=>Jo.waitUntil});Ar.exports=Vo(Tr);var Rr=hr(),zo=br(),Jo=vr()});var Z=ro(Ir());var W=crypto,pe=e=>e instanceof CryptoKey;var V=new TextEncoder,K=new TextDecoder,Kn=2**32;function Pr(...e){let r=e.reduce((n,{length:i})=>n+i,0),t=new Uint8Array(r),o=0;for(let n of e)t.set(n,o),o+=n.length;return t}var Ho=e=>{let r=atob(e),t=new Uint8Array(r.length);for(let o=0;o<r.length;o++)t[o]=r.charCodeAt(o);return t},I=e=>{let r=e;r instanceof Uint8Array&&(r=K.decode(r)),r=r.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Ho(r)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};var E=class extends Error{constructor(r,t){super(r,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}};E.code="ERR_JOSE_GENERIC";var T=class extends E{constructor(r,t,o="unspecified",n="unspecified"){super(r,{cause:{claim:o,reason:n,payload:t}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=o,this.reason=n,this.payload=t}};T.code="ERR_JWT_CLAIM_VALIDATION_FAILED";var z=class extends E{constructor(r,t,o="unspecified",n="unspecified"){super(r,{cause:{claim:o,reason:n,payload:t}}),this.code="ERR_JWT_EXPIRED",this.claim=o,this.reason=n,this.payload=t}};z.code="ERR_JWT_EXPIRED";var oe=class extends E{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}};oe.code="ERR_JOSE_ALG_NOT_ALLOWED";var _=class extends E{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}};_.code="ERR_JOSE_NOT_SUPPORTED";var Ie=class extends E{constructor(r="decryption operation failed",t){super(r,t),this.code="ERR_JWE_DECRYPTION_FAILED"}};Ie.code="ERR_JWE_DECRYPTION_FAILED";var Pe=class extends E{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}};Pe.code="ERR_JWE_INVALID";var g=class extends E{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}};g.code="ERR_JWS_INVALID";var M=class extends E{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}};M.code="ERR_JWT_INVALID";var Ne=class extends E{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}};Ne.code="ERR_JWK_INVALID";var J=class extends E{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}};J.code="ERR_JWKS_INVALID";var L=class extends E{constructor(r="no applicable key found in the JSON Web Key Set",t){super(r,t),this.code="ERR_JWKS_NO_MATCHING_KEY"}};L.code="ERR_JWKS_NO_MATCHING_KEY";var ne=class extends E{constructor(r="multiple matching keys found in the JSON Web Key Set",t){super(r,t),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}};ne.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";var ie=class extends E{constructor(r="request timed out",t){super(r,t),this.code="ERR_JWKS_TIMEOUT"}};ie.code="ERR_JWKS_TIMEOUT";var se=class extends E{constructor(r="signature verification failed",t){super(r,t),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};se.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function C(e,r="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${r} must be ${e}`)}function ue(e,r){return e.name===r}function Ce(e){return parseInt(e.name.slice(4),10)}function Go(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Fo(e,r){if(r.length&&!r.some(t=>e.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(r.length>2){let o=r.pop();t+=`one of ${r.join(", ")}, or ${o}.`}else r.length===2?t+=`one of ${r[0]} or ${r[1]}.`:t+=`${r[0]}.`;throw new TypeError(t)}}function Nr(e,r,...t){switch(r){case"HS256":case"HS384":case"HS512":{if(!ue(e.algorithm,"HMAC"))throw C("HMAC");let o=parseInt(r.slice(2),10);if(Ce(e.algorithm.hash)!==o)throw C(`SHA-${o}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ue(e.algorithm,"RSASSA-PKCS1-v1_5"))throw C("RSASSA-PKCS1-v1_5");let o=parseInt(r.slice(2),10);if(Ce(e.algorithm.hash)!==o)throw C(`SHA-${o}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ue(e.algorithm,"RSA-PSS"))throw C("RSA-PSS");let o=parseInt(r.slice(2),10);if(Ce(e.algorithm.hash)!==o)throw C(`SHA-${o}`,"algorithm.hash");break}case"EdDSA":{if(e.algorithm.name!=="Ed25519"&&e.algorithm.name!=="Ed448")throw C("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!ue(e.algorithm,"ECDSA"))throw C("ECDSA");let o=Go(r);if(e.algorithm.namedCurve!==o)throw C(o,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Fo(e,t)}function Cr(e,r,...t){if(t=t.filter(Boolean),t.length>2){let o=t.pop();e+=`one of type ${t.join(", ")}, or ${o}.`}else t.length===2?e+=`one of type ${t[0]} or ${t[1]}.`:e+=`of type ${t[0]}.`;return r==null?e+=` Received ${r}`:typeof r=="function"&&r.name?e+=` Received function ${r.name}`:typeof r=="object"&&r!=null&&r.constructor?.name&&(e+=` Received an instance of ${r.constructor.name}`),e}var je=(e,...r)=>Cr("Key must be ",e,...r);function Ue(e,r,...t){return Cr(`Key for the ${e} algorithm must be `,r,...t)}var Ke=e=>pe(e)?!0:e?.[Symbol.toStringTag]==="KeyObject",H=["CryptoKey"];var $o=(...e)=>{let r=e.filter(Boolean);if(r.length===0||r.length===1)return!0;let t;for(let o of r){let n=Object.keys(o);if(!t||t.size===0){t=new Set(n);continue}for(let i of n){if(t.has(i))return!1;t.add(i)}}return!0},jr=$o;function qo(e){return typeof e=="object"&&e!==null}function v(e){if(!qo(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let r=e;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}var Ur=(e,r)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:t}=r.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function j(e){return v(e)&&typeof e.kty=="string"}function Kr(e){return e.kty!=="oct"&&typeof e.d=="string"}function kr(e){return e.kty!=="oct"&&typeof e.d>"u"}function Dr(e){return j(e)&&e.kty==="oct"&&typeof e.k=="string"}function Xo(e){let r,t;switch(e.kty){case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},t=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},t=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},t=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":r={name:"ECDSA",namedCurve:"P-256"},t=e.d?["sign"]:["verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},t=e.d?["sign"]:["verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},t=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:"ECDH",namedCurve:e.crv},t=e.d?["deriveBits"]:[];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"EdDSA":r={name:e.crv},t=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":r={name:e.crv},t=e.d?["deriveBits"]:[];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new _('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:r,keyUsages:t}}var Qo=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:r,keyUsages:t}=Xo(e),o=[r,e.ext??!1,e.key_ops??t],n={...e};return delete n.alg,delete n.use,W.subtle.importKey("jwk",n,...o)},le=Qo;var Mr=e=>I(e),B,G,Lr=e=>e?.[Symbol.toStringTag]==="KeyObject",me=async(e,r,t,o,n=!1)=>{let i=e.get(r);if(i?.[o])return i[o];let c=await le({...t,alg:o});return n&&Object.freeze(r),i?i[o]=c:e.set(r,{[o]:c}),c},Zo=(e,r)=>{if(Lr(e)){let t=e.export({format:"jwk"});return delete t.d,delete t.dp,delete t.dq,delete t.p,delete t.q,delete t.qi,t.k?Mr(t.k):(G||(G=new WeakMap),me(G,e,t,r))}return j(e)?e.k?I(e.k):(G||(G=new WeakMap),me(G,e,e,r,!0)):e},en=(e,r)=>{if(Lr(e)){let t=e.export({format:"jwk"});return t.k?Mr(t.k):(B||(B=new WeakMap),me(B,e,t,r))}return j(e)?e.k?I(e.k):(B||(B=new WeakMap),me(B,e,e,r,!0)):e},ke={normalizePublicKey:Zo,normalizePrivateKey:en};async function de(e,r){if(!v(e))throw new TypeError("JWK must be an object");switch(r||(r=e.alg),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return I(e.k);case"RSA":if(e.oth!==void 0)throw new _('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return le({...e,alg:r});default:throw new _('Unsupported "kty" (Key Type) Parameter value')}}var F=e=>e?.[Symbol.toStringTag],De=(e,r,t)=>{if(r.use!==void 0&&r.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(r.key_ops!==void 0&&r.key_ops.includes?.(t)!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${t}`);if(r.alg!==void 0&&r.alg!==e)throw new TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},rn=(e,r,t,o)=>{if(!(r instanceof Uint8Array)){if(o&&j(r)){if(Dr(r)&&De(e,r,t))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Ke(r))throw new TypeError(Ue(e,r,...H,"Uint8Array",o?"JSON Web Key":null));if(r.type!=="secret")throw new TypeError(`${F(r)} instances for symmetric algorithms must be of type "secret"`)}},tn=(e,r,t,o)=>{if(o&&j(r))switch(t){case"sign":if(Kr(r)&&De(e,r,t))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(kr(r)&&De(e,r,t))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Ke(r))throw new TypeError(Ue(e,r,...H,o?"JSON Web Key":null));if(r.type==="secret")throw new TypeError(`${F(r)} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&r.type==="public")throw new TypeError(`${F(r)} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&r.type==="public")throw new TypeError(`${F(r)} instances for asymmetric algorithm decryption must be of type "private"`);if(r.algorithm&&t==="verify"&&r.type==="private")throw new TypeError(`${F(r)} instances for asymmetric algorithm verifying must be of type "public"`);if(r.algorithm&&t==="encrypt"&&r.type==="private")throw new TypeError(`${F(r)} instances for asymmetric algorithm encryption must be of type "public"`)};function Wr(e,r,t,o){r.startsWith("HS")||r==="dir"||r.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(r)?rn(r,t,o,e):tn(r,t,o,e)}var ai=Wr.bind(void 0,!1),Me=Wr.bind(void 0,!0);function on(e,r,t,o,n){if(n.crit!==void 0&&o?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!o||o.crit===void 0)return new Set;if(!Array.isArray(o.crit)||o.crit.length===0||o.crit.some(c=>typeof c!="string"||c.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;t!==void 0?i=new Map([...Object.entries(t),...r.entries()]):i=r;for(let c of o.crit){if(!i.has(c))throw new _(`Extension Header Parameter "${c}" is not recognized`);if(n[c]===void 0)throw new e(`Extension Header Parameter "${c}" is missing`);if(i.get(c)&&o[c]===void 0)throw new e(`Extension Header Parameter "${c}" MUST be integrity protected`)}return new Set(o.crit)}var Vr=on;var nn=(e,r)=>{if(r!==void 0&&(!Array.isArray(r)||r.some(t=>typeof t!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(r)return new Set(r)},zr=nn;function Le(e,r){let t=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:r.namedCurve};case"EdDSA":return{name:r.name};default:throw new _(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function We(e,r,t){if(t==="sign"&&(r=await ke.normalizePrivateKey(r,e)),t==="verify"&&(r=await ke.normalizePublicKey(r,e)),pe(r))return Nr(r,e,t),r;if(r instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(je(r,...H));return W.subtle.importKey("raw",r,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(je(r,...H,"Uint8Array","JSON Web Key"))}var sn=async(e,r,t,o)=>{let n=await We(e,r,"verify");Ur(e,n);let i=Le(e,n.algorithm);try{return await W.subtle.verify(i,n,t,o)}catch{return!1}},Jr=sn;async function Hr(e,r,t){if(!v(e))throw new g("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new g('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new g("JWS Protected Header incorrect type");if(e.payload===void 0)throw new g("JWS Payload missing");if(typeof e.signature!="string")throw new g("JWS Signature missing or incorrect type");if(e.header!==void 0&&!v(e.header))throw new g("JWS Unprotected Header incorrect type");let o={};if(e.protected)try{let _e=I(e.protected);o=JSON.parse(K.decode(_e))}catch{throw new g("JWS Protected Header is invalid")}if(!jr(o,e.header))throw new g("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...o,...e.header},i=Vr(g,new Map([["b64",!0]]),t?.crit,o,n),c=!0;if(i.has("b64")&&(c=o.b64,typeof c!="boolean"))throw new g('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if(typeof a!="string"||!a)throw new g('JWS "alg" (Algorithm) Header Parameter missing or invalid');let p=t&&zr("algorithms",t.algorithms);if(p&&!p.has(a))throw new oe('"alg" (Algorithm) Header Parameter value not allowed');if(c){if(typeof e.payload!="string")throw new g("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new g("JWS Payload must be a string or an Uint8Array instance");let f=!1;typeof r=="function"?(r=await r(o,e),f=!0,Me(a,r,"verify"),j(r)&&(r=await de(r,a))):Me(a,r,"verify");let u=Pr(V.encode(e.protected??""),V.encode("."),typeof e.payload=="string"?V.encode(e.payload):e.payload),y;try{y=I(e.signature)}catch{throw new g("Failed to base64url decode the signature")}if(!await Jr(a,r,y,u))throw new se;let R;if(c)try{R=I(e.payload)}catch{throw new g("Failed to base64url decode the payload")}else typeof e.payload=="string"?R=V.encode(e.payload):R=e.payload;let O={payload:R};return e.protected!==void 0&&(O.protectedHeader=o),e.header!==void 0&&(O.unprotectedHeader=e.header),f?{...O,key:r}:O}async function Br(e,r,t){if(e instanceof Uint8Array&&(e=K.decode(e)),typeof e!="string")throw new g("Compact JWS must be a string or Uint8Array");let{0:o,1:n,2:i,length:c}=e.split(".");if(c!==3)throw new g("Invalid Compact JWS");let a=await Hr({payload:n,protected:o,signature:i},r,t),p={payload:a.payload,protectedHeader:a.protectedHeader};return typeof r=="function"?{...p,key:a.key}:p}var Gr=e=>Math.floor(e.getTime()/1e3);var an=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Ve=e=>{let r=an.exec(e);if(!r||r[4]&&r[1])throw new TypeError("Invalid time period format");let t=parseFloat(r[2]),o=r[3].toLowerCase(),n;switch(o){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(t*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(t*3600);break;case"day":case"days":case"d":n=Math.round(t*86400);break;case"week":case"weeks":case"w":n=Math.round(t*604800);break;default:n=Math.round(t*31557600);break}return r[1]==="-"||r[4]==="ago"?-n:n};var Fr=e=>e.toLowerCase().replace(/^application\//,""),cn=(e,r)=>typeof e=="string"?r.includes(e):Array.isArray(e)?r.some(Set.prototype.has.bind(new Set(e))):!1,$r=(e,r,t={})=>{let o;try{o=JSON.parse(K.decode(r))}catch{}if(!v(o))throw new M("JWT Claims Set must be a top-level JSON object");let{typ:n}=t;if(n&&(typeof e.typ!="string"||Fr(e.typ)!==Fr(n)))throw new T('unexpected "typ" JWT header value',o,"typ","check_failed");let{requiredClaims:i=[],issuer:c,subject:a,audience:p,maxTokenAge:f}=t,u=[...i];f!==void 0&&u.push("iat"),p!==void 0&&u.push("aud"),a!==void 0&&u.push("sub"),c!==void 0&&u.push("iss");for(let O of new Set(u.reverse()))if(!(O in o))throw new T(`missing required "${O}" claim`,o,O,"missing");if(c&&!(Array.isArray(c)?c:[c]).includes(o.iss))throw new T('unexpected "iss" claim value',o,"iss","check_failed");if(a&&o.sub!==a)throw new T('unexpected "sub" claim value',o,"sub","check_failed");if(p&&!cn(o.aud,typeof p=="string"?[p]:p))throw new T('unexpected "aud" claim value',o,"aud","check_failed");let y;switch(typeof t.clockTolerance){case"string":y=Ve(t.clockTolerance);break;case"number":y=t.clockTolerance;break;case"undefined":y=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:S}=t,R=Gr(S||new Date);if((o.iat!==void 0||f)&&typeof o.iat!="number")throw new T('"iat" claim must be a number',o,"iat","invalid");if(o.nbf!==void 0){if(typeof o.nbf!="number")throw new T('"nbf" claim must be a number',o,"nbf","invalid");if(o.nbf>R+y)throw new T('"nbf" claim timestamp check failed',o,"nbf","check_failed")}if(o.exp!==void 0){if(typeof o.exp!="number")throw new T('"exp" claim must be a number',o,"exp","invalid");if(o.exp<=R-y)throw new z('"exp" claim timestamp check failed',o,"exp","check_failed")}if(f){let O=R-o.iat,_e=typeof f=="number"?f:Ve(f);if(O-y>_e)throw new z('"iat" claim timestamp check failed (too far in the past)',o,"iat","check_failed");if(O<0-y)throw new T('"iat" claim timestamp check failed (it should be in the past)',o,"iat","check_failed")}return o};async function ze(e,r,t){let o=await Br(e,r,t);if(o.protectedHeader.crit?.includes("b64")&&o.protectedHeader.b64===!1)throw new M("JWTs MUST NOT use unencoded payload");let i={payload:$r(o.protectedHeader,o.payload,t),protectedHeader:o.protectedHeader};return typeof r=="function"?{...i,key:o.key}:i}function fn(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new _('Unsupported "alg" value for a JSON Web Key Set')}}function pn(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(un)}function un(e){return v(e)}function Yr(e){return typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}var Je=class{constructor(r){if(this._cached=new WeakMap,!pn(r))throw new J("JSON Web Key Set malformed");this._jwks=Yr(r)}async getKey(r,t){let{alg:o,kid:n}={...r,...t?.header},i=fn(o),c=this._jwks.keys.filter(f=>{let u=i===f.kty;if(u&&typeof n=="string"&&(u=n===f.kid),u&&typeof f.alg=="string"&&(u=o===f.alg),u&&typeof f.use=="string"&&(u=f.use==="sig"),u&&Array.isArray(f.key_ops)&&(u=f.key_ops.includes("verify")),u&&o==="EdDSA"&&(u=f.crv==="Ed25519"||f.crv==="Ed448"),u)switch(o){case"ES256":u=f.crv==="P-256";break;case"ES256K":u=f.crv==="secp256k1";break;case"ES384":u=f.crv==="P-384";break;case"ES512":u=f.crv==="P-521";break}return u}),{0:a,length:p}=c;if(p===0)throw new L;if(p!==1){let f=new ne,{_cached:u}=this;throw f[Symbol.asyncIterator]=async function*(){for(let y of c)try{yield await qr(u,y,o)}catch{}},f}return qr(this._cached,a,o)}};async function qr(e,r,t){let o=e.get(r)||e.set(r,{}).get(r);if(o[t]===void 0){let n=await de({...r,ext:!0},t);if(n instanceof Uint8Array||n.type!=="public")throw new J("JSON Web Key Set members must be public keys");o[t]=n}return o[t]}function He(e){let r=new Je(e),t=async(o,n)=>r.getKey(o,n);return Object.defineProperties(t,{jwks:{value:()=>Yr(r._jwks),enumerable:!0,configurable:!1,writable:!1}}),t}var ln=async(e,r,t)=>{let o,n,i=!1;typeof AbortController=="function"&&(o=new AbortController,n=setTimeout(()=>{i=!0,o.abort()},r));let c=await fetch(e.href,{signal:o?o.signal:void 0,redirect:"manual",headers:t.headers}).catch(a=>{throw i?new ie:a});if(n!==void 0&&clearTimeout(n),c.status!==200)throw new E("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await c.json()}catch{throw new E("Failed to parse the JSON Web Key Set HTTP response as JSON")}},Xr=ln;function mn(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}var Be;(typeof navigator>"u"||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(Be="jose/v5.9.6");var he=Symbol();function dn(e,r){return!(typeof e!="object"||e===null||!("uat"in e)||typeof e.uat!="number"||Date.now()-e.uat>=r||!("jwks"in e)||!v(e.jwks)||!Array.isArray(e.jwks.keys)||!Array.prototype.every.call(e.jwks.keys,v))}var Ge=class{constructor(r,t){if(!(r instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(r.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration=typeof t?.timeoutDuration=="number"?t?.timeoutDuration:5e3,this._cooldownDuration=typeof t?.cooldownDuration=="number"?t?.cooldownDuration:3e4,this._cacheMaxAge=typeof t?.cacheMaxAge=="number"?t?.cacheMaxAge:6e5,t?.[he]!==void 0&&(this._cache=t?.[he],dn(t?.[he],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=He(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(r,t){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(r,t)}catch(o){if(o instanceof L&&this.coolingDown()===!1)return await this.reload(),this._local(r,t);throw o}}async reload(){this._pendingFetch&&mn()&&(this._pendingFetch=void 0);let r=new Headers(this._options.headers);Be&&!r.has("User-Agent")&&(r.set("User-Agent",Be),this._options.headers=Object.fromEntries(r.entries())),this._pendingFetch||(this._pendingFetch=Xr(this._url,this._timeoutDuration,this._options).then(t=>{this._local=He(t),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=t),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(t=>{throw this._pendingFetch=void 0,t})),await this._pendingFetch}};function Fe(e,r){let t=new Ge(e,r),o=async(n,i)=>t.getKey(n,i);return Object.defineProperties(o,{coolingDown:{get:()=>t.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>t.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>t.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!t._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>t._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),o}var $e,qe,Ye,Xe,Qe,hn=typeof window<"u"&&typeof window.document<"u",yn=typeof self=="object"&&typeof self?.importScripts=="function"&&((($e=self.constructor)===null||$e===void 0?void 0:$e.name)==="DedicatedWorkerGlobalScope"||((qe=self.constructor)===null||qe===void 0?void 0:qe.name)==="ServiceWorkerGlobalScope"||((Ye=self.constructor)===null||Ye===void 0?void 0:Ye.name)==="SharedWorkerGlobalScope"),Qr=typeof Deno<"u"&&typeof Deno.version<"u"&&typeof Deno.version.deno<"u",Zr=typeof Bun<"u"&&typeof Bun.version<"u",gn=typeof process<"u"&&!!process.version&&!!(!((Xe=process.versions)===null||Xe===void 0)&&Xe.node)&&!Qr&&!Zr,bn=typeof navigator<"u"&&navigator?.product==="ReactNative",En=typeof globalThis<"u"&&((Qe=globalThis?.navigator)===null||Qe===void 0?void 0:Qe.userAgent)==="Cloudflare-Workers",Ze=xn();function xn(){return hn?{type:"browser",version:window.navigator.userAgent}:En?{type:"workerd"}:yn?{type:"web-worker"}:Qr?{type:"deno",version:Deno.version.deno}:Zr?{type:"bun",version:Bun.version}:gn?{type:"node",version:process.versions.node,parsedVersion:Number(process.versions.node.split(".")[0])}:bn?{type:"react-native"}:{type:"unknown"}}var s={};Zt(s,{JsonError:()=>$,ParseError:()=>q,any:()=>dt,bigint:()=>rt,boolean:()=>ht,booleanLiteral:()=>mt,date:()=>tt,discriminant:()=>Ot,enum_:()=>ge,getObjectLikeUtils:()=>P,getObjectUtils:()=>X,getSchemaUtils:()=>h,isProperty:()=>D,lazy:()=>ot,lazyObject:()=>pt,list:()=>Ee,number:()=>yt,object:()=>be,objectWithoutOptionalProperties:()=>ft,optional:()=>er,property:()=>it,record:()=>xt,set:()=>_t,string:()=>gt,stringLiteral:()=>lt,transform:()=>rr,undiscriminatedUnion:()=>wt,union:()=>Rt,unknown:()=>bt,withParsedProperties:()=>or});var l={BIGINT:"bigint",DATE:"date",ENUM:"enum",LIST:"list",STRING_LITERAL:"stringLiteral",BOOLEAN_LITERAL:"booleanLiteral",OBJECT:"object",ANY:"any",BOOLEAN:"boolean",NUMBER:"number",STRING:"string",UNKNOWN:"unknown",RECORD:"record",SET:"set",UNION:"union",UNDISCRIMINATED_UNION:"undiscriminatedUnion",OPTIONAL:"optional"};function m(e,r){return`Expected ${r}. Received ${_n(e)}.`}function _n(e){if(Array.isArray(e))return"list";if(e===null)return"null";if(e instanceof BigInt)return"BigInt";switch(typeof e){case"string":return`"${e}"`;case"bigint":case"number":case"boolean":case"undefined":return`${e}`}return typeof e}function x(e){return Object.assign(Object.assign({},e),{json:et(e.json),parse:et(e.parse)})}function et(e){return(r,t)=>{let o=e(r,t),{skipValidation:n=!1}=t??{};return!o.ok&&n?(console.warn(["Failed to validate.",...o.errors.map(i=>"  - "+(i.path.length>0?`${i.path.join(".")}: ${i.message}`:i.message))].join(`
`)),{ok:!0,value:r}):o}}function ye(e){return e.path.length===0?e.message:`${e.path.join(" -> ")}: ${e.message}`}var $=class e extends Error{constructor(r){super(r.map(ye).join("; ")),this.errors=r,Object.setPrototypeOf(this,e.prototype)}};var q=class e extends Error{constructor(r){super(r.map(ye).join("; ")),this.errors=r,Object.setPrototypeOf(this,e.prototype)}};function h(e){return{optional:()=>er(e),transform:r=>rr(e,r),parseOrThrow:(r,t)=>{let o=e.parse(r,t);if(o.ok)return o.value;throw new q(o.errors)},jsonOrThrow:(r,t)=>{let o=e.json(r,t);if(o.ok)return o.value;throw new $(o.errors)}}}function er(e){let r={parse:(t,o)=>t==null?{ok:!0,value:void 0}:e.parse(t,o),json:(t,o)=>o?.omitUndefined&&t===void 0?{ok:!0,value:void 0}:t==null?{ok:!0,value:null}:e.json(t,o),getType:()=>l.OPTIONAL};return Object.assign(Object.assign({},r),h(r))}function rr(e,r){let t={parse:(o,n)=>{let i=e.parse(o,n);return i.ok?{ok:!0,value:r.transform(i.value)}:i},json:(o,n)=>{let i=r.untransform(o);return e.json(i,n)},getType:()=>e.getType()};return Object.assign(Object.assign({},t),h(t))}function rt(){let e={parse:(r,{breadcrumbsPrefix:t=[]}={})=>typeof r!="string"?{ok:!1,errors:[{path:t,message:m(r,"string")}]}:{ok:!0,value:BigInt(r)},json:(r,{breadcrumbsPrefix:t=[]}={})=>typeof r=="bigint"?{ok:!0,value:r.toString()}:{ok:!1,errors:[{path:t,message:m(r,"bigint")}]},getType:()=>l.BIGINT};return Object.assign(Object.assign({},x(e)),h(e))}var Sn=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function tt(){let e={parse:(r,{breadcrumbsPrefix:t=[]}={})=>typeof r!="string"?{ok:!1,errors:[{path:t,message:m(r,"string")}]}:Sn.test(r)?{ok:!0,value:new Date(r)}:{ok:!1,errors:[{path:t,message:m(r,"ISO 8601 date string")}]},json:(r,{breadcrumbsPrefix:t=[]}={})=>r instanceof Date?{ok:!0,value:r.toISOString()}:{ok:!1,errors:[{path:t,message:m(r,"Date object")}]},getType:()=>l.DATE};return Object.assign(Object.assign({},x(e)),h(e))}function w(e,r){return()=>{let t={parse:r,json:r,getType:()=>e};return Object.assign(Object.assign({},x(t)),h(t))}}function ge(e){let r=new Set(e);return w(l.ENUM,(o,{allowUnrecognizedEnumValues:n,breadcrumbsPrefix:i=[]}={})=>typeof o!="string"?{ok:!1,errors:[{path:i,message:m(o,"string")}]}:!r.has(o)&&!n?{ok:!1,errors:[{path:i,message:m(o,"enum")}]}:{ok:!0,value:o})()}function ot(e){let r=tr(e);return Object.assign(Object.assign({},r),h(r))}function tr(e){return{parse:(r,t)=>Y(e).parse(r,t),json:(r,t)=>Y(e).json(r,t),getType:()=>Y(e).getType()}}function Y(e){let r=e;return r.__zurg_memoized==null&&(r.__zurg_memoized=e()),r.__zurg_memoized}function ae(e){return Object.entries(e)}function ce(e,r){let t=new Set(r);return Object.entries(e).reduce((o,[n,i])=>(t.has(n)&&(o[n]=i),o),{})}function k(e){if(typeof e!="object"||e===null)return!1;if(Object.getPrototypeOf(e)===null)return!0;let r=e;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}function fe(e){return Object.keys(e)}function nt(e,r){let t=[],o=[];for(let n of e)r(n)?t.push(n):o.push(n);return[t,o]}function P(e){return{withParsedProperties:r=>or(e,r)}}function or(e,r){let t={parse:(o,n)=>{let i=e.parse(o,n);if(!i.ok)return i;let c=Object.entries(r).reduce((a,[p,f])=>Object.assign(Object.assign({},a),{[p]:typeof f=="function"?f(i.value):f}),{});return{ok:!0,value:Object.assign(Object.assign({},i.value),c)}},json:(o,n)=>{var i;if(!k(o))return{ok:!1,errors:[{path:(i=n?.breadcrumbsPrefix)!==null&&i!==void 0?i:[],message:m(o,"object")}]};let c=new Set(Object.keys(r)),a=ce(o,Object.keys(o).filter(p=>!c.has(p)));return e.json(a,n)},getType:()=>e.getType()};return Object.assign(Object.assign(Object.assign({},t),h(t)),P(t))}function it(e,r){return{rawKey:e,valueSchema:r,isProperty:!0}}function D(e){return e.isProperty}function be(e){let r={_getRawProperties:()=>Object.entries(e).map(([t,o])=>D(o)?o.rawKey:t),_getParsedProperties:()=>fe(e),parse:(t,o)=>{let n={},i=[];for(let[c,a]of ae(e)){let p=D(a)?a.rawKey:c,f=D(a)?a.valueSchema:a,u={rawKey:p,parsedKey:c,valueSchema:f};n[p]=u,ct(f)&&i.push(p)}return st({value:t,requiredKeys:i,getProperty:c=>{let a=n[c];if(a!=null)return{transformedKey:a.parsedKey,transform:p=>{var f;return a.valueSchema.parse(p,Object.assign(Object.assign({},o),{breadcrumbsPrefix:[...(f=o?.breadcrumbsPrefix)!==null&&f!==void 0?f:[],c]}))}}},unrecognizedObjectKeys:o?.unrecognizedObjectKeys,skipValidation:o?.skipValidation,breadcrumbsPrefix:o?.breadcrumbsPrefix,omitUndefined:o?.omitUndefined})},json:(t,o)=>{let n=[];for(let[i,c]of ae(e)){let a=D(c)?c.valueSchema:c;ct(a)&&n.push(i)}return st({value:t,requiredKeys:n,getProperty:i=>{let c=e[i];if(c!=null)return D(c)?{transformedKey:c.rawKey,transform:a=>{var p;return c.valueSchema.json(a,Object.assign(Object.assign({},o),{breadcrumbsPrefix:[...(p=o?.breadcrumbsPrefix)!==null&&p!==void 0?p:[],i]}))}}:{transformedKey:i,transform:a=>{var p;return c.json(a,Object.assign(Object.assign({},o),{breadcrumbsPrefix:[...(p=o?.breadcrumbsPrefix)!==null&&p!==void 0?p:[],i]}))}}},unrecognizedObjectKeys:o?.unrecognizedObjectKeys,skipValidation:o?.skipValidation,breadcrumbsPrefix:o?.breadcrumbsPrefix,omitUndefined:o?.omitUndefined})},getType:()=>l.OBJECT};return Object.assign(Object.assign(Object.assign(Object.assign({},x(r)),h(r)),P(r)),X(r))}function st({value:e,requiredKeys:r,getProperty:t,unrecognizedObjectKeys:o="fail",skipValidation:n=!1,breadcrumbsPrefix:i=[]}){if(!k(e))return{ok:!1,errors:[{path:i,message:m(e,"object")}]};let c=new Set(r),a=[],p={};for(let[f,u]of Object.entries(e)){let y=t(f);if(y!=null){c.delete(f);let S=y.transform(u);S.ok?p[y.transformedKey]=S.value:(p[f]=u,a.push(...S.errors))}else switch(o){case"fail":a.push({path:[...i,f],message:`Unexpected key "${f}"`});break;case"strip":break;case"passthrough":p[f]=u;break}}return a.push(...r.filter(f=>c.has(f)).map(f=>({path:i,message:`Missing required key "${f}"`}))),a.length===0||n?{ok:!0,value:p}:{ok:!1,errors:a}}function X(e){return{extend:r=>{let t={_getParsedProperties:()=>[...e._getParsedProperties(),...r._getParsedProperties()],_getRawProperties:()=>[...e._getRawProperties(),...r._getRawProperties()],parse:(o,n)=>at({extensionKeys:r._getRawProperties(),value:o,transformBase:i=>e.parse(i,n),transformExtension:i=>r.parse(i,n)}),json:(o,n)=>at({extensionKeys:r._getParsedProperties(),value:o,transformBase:i=>e.json(i,n),transformExtension:i=>r.json(i,n)}),getType:()=>l.OBJECT};return Object.assign(Object.assign(Object.assign(Object.assign({},t),h(t)),P(t)),X(t))}}}function at({extensionKeys:e,value:r,transformBase:t,transformExtension:o}){let n=new Set(e),[i,c]=nt(fe(r),f=>n.has(f)),a=t(ce(r,c)),p=o(ce(r,i));return a.ok&&p.ok?{ok:!0,value:Object.assign(Object.assign({},a.value),p.value)}:{ok:!1,errors:[...a.ok?[]:a.errors,...p.ok?[]:p.errors]}}function ct(e){return!wn(e)}function wn(e){switch(e.getType()){case l.ANY:case l.UNKNOWN:case l.OPTIONAL:return!0;default:return!1}}function ft(e){return be(e)}function pt(e){let r=Object.assign(Object.assign({},tr(e)),{_getRawProperties:()=>Y(e)._getRawProperties(),_getParsedProperties:()=>Y(e)._getParsedProperties()});return Object.assign(Object.assign(Object.assign(Object.assign({},r),h(r)),P(r)),X(r))}function Ee(e){let r={parse:(t,o)=>ut(t,(n,i)=>{var c;return e.parse(n,Object.assign(Object.assign({},o),{breadcrumbsPrefix:[...(c=o?.breadcrumbsPrefix)!==null&&c!==void 0?c:[],`[${i}]`]}))}),json:(t,o)=>ut(t,(n,i)=>{var c;return e.json(n,Object.assign(Object.assign({},o),{breadcrumbsPrefix:[...(c=o?.breadcrumbsPrefix)!==null&&c!==void 0?c:[],`[${i}]`]}))}),getType:()=>l.LIST};return Object.assign(Object.assign({},x(r)),h(r))}function ut(e,r){return Array.isArray(e)?e.map((o,n)=>r(o,n)).reduce((o,n)=>{if(o.ok&&n.ok)return{ok:!0,value:[...o.value,n.value]};let i=[];return o.ok||i.push(...o.errors),n.ok||i.push(...n.errors),{ok:!1,errors:i}},{ok:!0,value:[]}):{ok:!1,errors:[{message:m(e,"list"),path:[]}]}}function lt(e){return w(l.STRING_LITERAL,(t,{breadcrumbsPrefix:o=[]}={})=>t===e?{ok:!0,value:e}:{ok:!1,errors:[{path:o,message:m(t,`"${e}"`)}]})()}function mt(e){return w(l.BOOLEAN_LITERAL,(t,{breadcrumbsPrefix:o=[]}={})=>t===e?{ok:!0,value:e}:{ok:!1,errors:[{path:o,message:m(t,`${e.toString()}`)}]})()}var dt=w(l.ANY,e=>({ok:!0,value:e}));var ht=w(l.BOOLEAN,(e,{breadcrumbsPrefix:r=[]}={})=>typeof e=="boolean"?{ok:!0,value:e}:{ok:!1,errors:[{path:r,message:m(e,"boolean")}]});var yt=w(l.NUMBER,(e,{breadcrumbsPrefix:r=[]}={})=>typeof e=="number"?{ok:!0,value:e}:{ok:!1,errors:[{path:r,message:m(e,"number")}]});var gt=w(l.STRING,(e,{breadcrumbsPrefix:r=[]}={})=>typeof e=="string"?{ok:!0,value:e}:{ok:!1,errors:[{path:r,message:m(e,"string")}]});var bt=w(l.UNKNOWN,e=>({ok:!0,value:e}));function xt(e,r){let t={parse:(o,n)=>Et({value:o,isKeyNumeric:e.getType()===l.NUMBER,transformKey:i=>{var c;return e.parse(i,Object.assign(Object.assign({},n),{breadcrumbsPrefix:[...(c=n?.breadcrumbsPrefix)!==null&&c!==void 0?c:[],`${i} (key)`]}))},transformValue:(i,c)=>{var a;return r.parse(i,Object.assign(Object.assign({},n),{breadcrumbsPrefix:[...(a=n?.breadcrumbsPrefix)!==null&&a!==void 0?a:[],`${c}`]}))},breadcrumbsPrefix:n?.breadcrumbsPrefix}),json:(o,n)=>Et({value:o,isKeyNumeric:e.getType()===l.NUMBER,transformKey:i=>{var c;return e.json(i,Object.assign(Object.assign({},n),{breadcrumbsPrefix:[...(c=n?.breadcrumbsPrefix)!==null&&c!==void 0?c:[],`${i} (key)`]}))},transformValue:(i,c)=>{var a;return r.json(i,Object.assign(Object.assign({},n),{breadcrumbsPrefix:[...(a=n?.breadcrumbsPrefix)!==null&&a!==void 0?a:[],`${c}`]}))},breadcrumbsPrefix:n?.breadcrumbsPrefix}),getType:()=>l.RECORD};return Object.assign(Object.assign({},x(t)),h(t))}function Et({value:e,isKeyNumeric:r,transformKey:t,transformValue:o,breadcrumbsPrefix:n=[]}){return k(e)?ae(e).reduce((i,[c,a])=>{if(a==null)return i;let p=i,f=c;if(r){let R=c.length>0?Number(c):NaN;isNaN(R)||(f=R)}let u=t(f),y=o(a,f);if(p.ok&&u.ok&&y.ok)return{ok:!0,value:Object.assign(Object.assign({},p.value),{[u.value]:y.value})};let S=[];return p.ok||S.push(...p.errors),u.ok||S.push(...u.errors),y.ok||S.push(...y.errors),{ok:!1,errors:S}},{ok:!0,value:{}}):{ok:!1,errors:[{path:n,message:m(e,"object")}]}}function _t(e){let r=Ee(e),t={parse:(o,n)=>{let i=r.parse(o,n);return i.ok?{ok:!0,value:new Set(i.value)}:i},json:(o,n)=>{var i;return o instanceof Set?r.json([...o],n):{ok:!1,errors:[{path:(i=n?.breadcrumbsPrefix)!==null&&i!==void 0?i:[],message:m(o,"Set")}]}},getType:()=>l.SET};return Object.assign(Object.assign({},x(t)),h(t))}function wt(e){let r={parse:(t,o)=>St((n,i)=>n.parse(t,i),e,o),json:(t,o)=>St((n,i)=>n.json(t,i),e,o),getType:()=>l.UNDISCRIMINATED_UNION};return Object.assign(Object.assign({},x(r)),h(r))}function St(e,r,t){let o=[];for(let[n,i]of r.entries()){let c=e(i,Object.assign(Object.assign({},t),{skipValidation:!1}));if(c.ok)return c;for(let a of c.errors)o.push({path:a.path,message:`[Variant ${n}] ${a.message}`})}return{ok:!1,errors:o}}function Ot(e,r){return{parsedDiscriminant:e,rawDiscriminant:r}}var On=function(e,r){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&r.indexOf(o)<0&&(t[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)r.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(t[o[n]]=e[o[n]]);return t};function Rt(e,r){let t=typeof e=="string"?e:e.rawDiscriminant,o=typeof e=="string"?e:e.parsedDiscriminant,n=ge(fe(r)),i={parse:(c,a)=>vt({value:c,discriminant:t,transformedDiscriminant:o,transformDiscriminantValue:p=>{var f;return n.parse(p,{allowUnrecognizedEnumValues:a?.allowUnrecognizedUnionMembers,breadcrumbsPrefix:[...(f=a?.breadcrumbsPrefix)!==null&&f!==void 0?f:[],t]})},getAdditionalPropertiesSchema:p=>r[p],allowUnrecognizedUnionMembers:a?.allowUnrecognizedUnionMembers,transformAdditionalProperties:(p,f)=>f.parse(p,a),breadcrumbsPrefix:a?.breadcrumbsPrefix}),json:(c,a)=>vt({value:c,discriminant:o,transformedDiscriminant:t,transformDiscriminantValue:p=>{var f;return n.json(p,{allowUnrecognizedEnumValues:a?.allowUnrecognizedUnionMembers,breadcrumbsPrefix:[...(f=a?.breadcrumbsPrefix)!==null&&f!==void 0?f:[],o]})},getAdditionalPropertiesSchema:p=>r[p],allowUnrecognizedUnionMembers:a?.allowUnrecognizedUnionMembers,transformAdditionalProperties:(p,f)=>f.json(p,a),breadcrumbsPrefix:a?.breadcrumbsPrefix}),getType:()=>l.UNION};return Object.assign(Object.assign(Object.assign({},x(i)),h(i)),P(i))}function vt({value:e,discriminant:r,transformedDiscriminant:t,transformDiscriminantValue:o,getAdditionalPropertiesSchema:n,allowUnrecognizedUnionMembers:i=!1,transformAdditionalProperties:c,breadcrumbsPrefix:a=[]}){if(!k(e))return{ok:!1,errors:[{path:a,message:m(e,"object")}]};let p=e,f=r,u=p[f],y=On(p,[typeof f=="symbol"?f:f+""]);if(u==null)return{ok:!1,errors:[{path:a,message:`Missing discriminant ("${r}")`}]};let S=o(u);if(!S.ok)return{ok:!1,errors:S.errors};let R=n(S.value);if(R==null)return i?{ok:!0,value:Object.assign({[t]:S.value},y)}:{ok:!1,errors:[{path:[...a,r],message:"Unexpected discriminant value"}]};let O=c(y,R);return O.ok?{ok:!0,value:Object.assign({[t]:u},O.value)}:O}var A=s.object({organizationId:s.string(),agentId:s.string(),settings:s.record(s.string(),s.unknown())});var Tt=s.object({}).extend(A);var At=s.object({}).extend(A);var It=s.enum_(["CONVERSATION","CONVERSATION_MESSAGE","KNOWLEDGE_BASE","KNOWLEDGE_DOCUMENT","ACTION","USER","USER_EVENT","EVENT_TRIGGER","USER_PROFILE","FEEDBACK"]);var Q=s.object({referenceId:s.string()});var N=s.object({type:It,appId:s.string(),organizationId:s.string(),agentId:s.string()}).extend(Q);var Pt=s.enum_(["THUMBS_UP","THUMBS_DOWN","INSERT","HANDOFF"]);var Nt=s.object({type:Pt,text:s.string().optional()});var Ct=s.object({feedbackId:N,conversationId:N,conversationMessageId:N}).extend(Nt);var jt=s.object({feedbacks:s.list(Ct)}).extend(A);var Ut=s.object({conversations:s.list(N)}).extend(A);var Kt=s.object({allUserData:s.record(s.string(),s.record(s.string(),s.string())),defaultUserData:s.record(s.string(),s.string())});var kt=s.object({actionId:s.string(),conversationMetadata:s.record(s.string(),s.string()),parameters:s.record(s.string(),s.unknown()),user:Kt}).extend(A);var zp=s.object({response:s.string()});var Dt=s.object({knowledgeBaseId:Q}).extend(A);var tu=s.object({message:s.string().optional()});function Mt(e){return e}var Lt=s.string().transform({transform:Mt,untransform:e=>e});var Wt=s.enum_(["text","array","color"]);var Vt=s.object({displayName:s.string(),description:s.string().optional(),type:Wt});var dl=s.record(Lt,Vt);var zt=s.enum_(["EMAIL","PHONE_NUMBER"]);var Jt=s.object({value:s.string(),type:zt});var Ht=s.enum_(["VISIBLE","PARTIALLY_VISIBLE","HIDDEN"]);var Bt=s.object({value:s.string(),visibility:Ht});var xe=s.object({identifiers:s.list(Jt),data:s.record(s.string(),Bt)});var Tl=s.object({userId:Q}).extend(xe);var Nl=s.object({userId:N,allUserData:s.record(s.string(),s.record(s.string(),s.string())),defaultUserData:s.record(s.string(),s.string())}).extend(xe);var Gt=s.enum_(["CONVERSATION_CREATED","FEEDBACK_CREATED"]);var Ft=s.object({description:s.string(),type:Gt});var Ml=s.object({triggerId:N}).extend(Ft);var Wl=s.object({number:s.number(),size:s.number(),totalElements:s.number(),totalPages:s.number()});import ee from"../..";async function re(e){let t=`https://developers${process.env.ENVIRONMENT===void 0?"":`.${process.env.ENVIRONMENT==="sandbox"?`${process.env.SANDBOX_USER}.sb`:process.env.ENVIRONMENT}`}.mavenagi-apis.com/.well-known/jwks`,o=Fe(new URL(t)),n=e.headers.get("authorization").replace("Bearer ","");await ze(n,o,{issuer:"https://developers.mavenagi.com",audience:process.env.MAVENAGI_APP_ID})}async function _m(e){await re(e);let{organizationId:r,agentId:t,settings:o,actionId:n,conversationMetadata:i,parameters:c,user:a}=kt.parseOrThrow(await e.json(),{unrecognizedObjectKeys:"strip",allowUnrecognizedEnumValues:!0,allowUnrecognizedUnionMembers:!0});try{let p=await ee.executeAction?.({organizationId:r,agentId:t,settings:o,actionId:n,conversationMetadata:i,parameters:c,user:a});return new Response(JSON.stringify({response:p}),{status:200,headers:{"Content-Type":"application/json"}})}catch(p){return console.error(p),p instanceof Error?new Response(p.message,{status:500}):new Response("No result returned",{status:204})}}async function Sm(e){await re(e);let{organizationId:r,agentId:t,settings:o,feedbacks:n}=jt.parseOrThrow(await e.json(),{unrecognizedObjectKeys:"strip",allowUnrecognizedEnumValues:!0,allowUnrecognizedUnionMembers:!0});try{return await ee.feedbackCreatedOrUpdated?.({organizationId:r,agentId:t,settings:o,feedbacks:n,ctx:{waitUntil:Z.waitUntil}}),new Response(null)}catch(i){return console.error(i),i instanceof Error?new Response(i.message,{status:500}):new Response("Unknown error",{status:500})}}async function wm(e){await re(e);let{organizationId:r,agentId:t,settings:o,conversations:n}=Ut.parseOrThrow(await e.json(),{unrecognizedObjectKeys:"strip",allowUnrecognizedEnumValues:!0,allowUnrecognizedUnionMembers:!0});try{return await ee.conversationCreatedOrUpdated?.({organizationId:r,agentId:t,settings:o,conversations:n,ctx:{waitUntil:Z.waitUntil}}),new Response(null)}catch(i){return console.error(i),i instanceof Error?new Response(i.message,{status:500}):new Response("Unknown error",{status:500})}}async function Om(e){await re(e);let{organizationId:r,agentId:t,settings:o,knowledgeBaseId:n}=Dt.parseOrThrow(await e.json(),{unrecognizedObjectKeys:"strip",allowUnrecognizedEnumValues:!0,allowUnrecognizedUnionMembers:!0});try{return await ee.knowledgeBaseRefreshed?.({organizationId:r,agentId:t,knowledgeBaseId:n,settings:o,ctx:{waitUntil:Z.waitUntil}}),new Response(null)}catch(i){return console.error(i),i instanceof Error?new Response(i.message,{status:500}):new Response("Unknown error",{status:500})}}async function vm(e){await re(e);let{organizationId:r,agentId:t,settings:o}=At.parseOrThrow(await e.json(),{unrecognizedObjectKeys:"strip",allowUnrecognizedEnumValues:!0,allowUnrecognizedUnionMembers:!0});try{return await ee.postInstall?.({organizationId:r,agentId:t,settings:o,ctx:{waitUntil:Z.waitUntil}}),new Response(null)}catch(n){return console.error(n),n instanceof Error?new Response(n.message,{status:400}):new Response("Unknown error",{status:500})}}async function Rm(e){await re(e);let{organizationId:r,agentId:t,settings:o}=Tt.parseOrThrow(await e.json(),{unrecognizedObjectKeys:"strip",allowUnrecognizedEnumValues:!0,allowUnrecognizedUnionMembers:!0});try{return await ee.preInstall?.({organizationId:r,agentId:t,settings:o,ctx:{waitUntil:Z.waitUntil}}),new Response(null)}catch(n){return console.error(n),n instanceof Error?new Response(n.message,{status:400}):new Response("Unknown error",{status:500})}}export{wm as conversationCreatedOrUpdated,_m as executeAction,Sm as feedbackCreatedOrUpdated,Om as knowledgeBaseRefreshed,vm as postInstall,Rm as preInstall};
